<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see http://www.gnu.org/licenses/
-->

<xwikidoc version="1.1">
  <web>PhenoTips</web>
  <name>CarePathways</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1511376119000</creationDate>
  <parent>PhenoTips.PatientSheet</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1511386066000</date>
  <contentUpdateDate>1511380748000</contentUpdateDate>
  <version>1.1</version>
  <title/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{velocity output=false}}
#set ($testTerm = "CP:02")
#set ($metabolicTerm = "CP:1160")
#set ($careTerm = "CP:03")
#set ($geneticTerm = "CP:11")
#set ($diagnosticTerm = "CP:12")
#set ($termsExcludedFromPath = ['CP:01', 'CP:11', 'CP:12', 'CP:13', 'CP:02', 'CP:03', 'CP:04', 'CP:31', 'CP:32', 'CP:08', 'CP:09'])
#macro (__displayDate $fuzzyDate)
  #if($!{fuzzyDate.opt('year')})$!{fuzzyDate.opt('year')}#{end}#if($!{fuzzyDate.opt('month')})-${stringtool.leftPad($fuzzyDate.opt('month'), 2, '0')}#{end}#if($!{fuzzyDate.opt('day')})-${stringtool.leftPad($fuzzyDate.opt('day'), 2, '0')}#{end}
#end
##
##
#macro (__displayRow $propName)
  #set ($value = "$doc.display($propName).trim()")
  #if ($value != '')
  &lt;dt class="$propName"&gt;##
    {{/html}}##
    #__label($propName "" "")##
    {{html clean="false" wiki="false"}}##
  &lt;/dt&gt;##
  &lt;dd class="$propName"&gt;##
   {{/html}}##
   $value
   {{html clean="false" wiki="false"}}##
  &lt;/dd&gt;##
  #end
#end
##
##
##
#macro (__displayModuleGroup $question $variantNumber $groupTitle $modules $modulesLastIdx $sheet $storageClass $retrieveStoredData $editable)
#if ("$!{groupTitle}" != "" || "$!{variantNumber}" != "")##
  &lt;tr class="table-row variant-label-row"&gt;
    &lt;td colspan="2"&gt;
      &lt;h2 class="module-group-label group-label"&gt;
        &lt;input type="hidden" class="variant-number" value="$!{variantNumber}"&gt;
        #if($!{groupTitle.trim()} != '')
          &lt;p&gt;${groupTitle}&lt;/p&gt;
        #else
          &lt;p&gt;${variantNumber}&lt;/p&gt;
        #end
      &lt;/h2&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
#end##
#foreach ($i in [0..${modulesLastIdx}])
  #set($module = $modules.get($i))
  #__buildCategoryModule($module, $question, $variantNumber, $storageClass, $retrieveStoredData, $editable)
#end##
#end
##
##
##
#macro(__buildCategoryModule $module $question $variantNumber $storageClass $retrieveStoredData $editable)
  #set ($storedValues = {})##
  #set ($curSubject = $!{module.get('subject')})
  #set ($moduleName = $!{module.get('module')})
  #set ($associatedVariantType = $!{module.get('type')})
  #if ($retrieveStoredData || !$editable)
    #__getStoredValues("$!{question}", "$!{curSubject}", "$!{moduleName}", "$!{associatedVariantType}", "$!{variantNumber}", $storedValues, $storageClass)##
  #end
  #if ($editable)##
    #__buildCategoryModuleEditMode($module, $question, $variantNumber, $storedValues)
  #else
    #__buildCategoryModuleViewMode($module, $question, $variantNumber, $storedValues)
  #end##
#end
##
##
#macro (__displayVariantList)
  #set ($cpGeneClassName = 'PhenoTips.CPGeneClass')
  #set ($cpVariantClassName = 'PhenoTips.CPGeneVariantClass')
  #set ($type = $module.submodule)
  #if ($module.subject == 'trio')
    #set ($subjects = ['proband', 'mother', 'father'])
  #else
    #set ($subjects = ['proband'])
  #end
  #set ($geneStatus = $stringtool.defaultIfEmpty($module.geneStatus, 'confirmed'))
  #set ($variantStatus = $stringtool.defaultIfEmpty($module.variantStatus, 'primary'))
  #set ($clearVariantData = $doc.getURL("get", "sheet=$!{class.name}&amp;action=cpcleargenes&amp;geneclassname=PhenoTips.CPGeneClass&amp;variantclassname=PhenoTips.CPGeneVariantClass&amp;genestatus=${geneStatus}&amp;variantstatus=${variantStatus}&amp;form_token=$!{services.csrf.getToken()}"))
  &lt;div class="no-variants-container"&gt;
  &lt;input type="hidden" id="clear-${type}-data" class="clear-data-url" value="$clearVariantData"/&gt;
  {{/html}}##
    #set ($propName = "no${stringtool.capitalize($type)}Variants")##
    #set ($hasNoVariants = $obj.getValue($propName) == 1)
    #if ($xcontext.action == 'edit')##
      #__form_field($propName) ##
    #end##
    #if ($hasNoVariants || $xcontext.action == 'edit')##
      #__form_label($propName '' '')##
    #end
  {{html clean="false" wiki="false"}}##
  &lt;/div&gt;
  #if ($xcontext.action == 'edit' || !$hasNoVariants )##
  &lt;div id="${type}-wes-variants-all" class="${type}-variants-container variants-container"&gt;
    #foreach ($subject in $subjects)
      #if ($subjects.size() &gt; 1)&lt;h2 class="subject-label group-label"&gt;&lt;span&gt;&lt;strong&gt;$escapetool.xml($services.localization.render("phenotips.carePathways.multiPicker.subject.${subject}"))&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;#end
      #if ($xcontext.action == 'edit' || $doc.getObject($cpGeneClassName, 'status', ${geneStatus}))##
      &lt;div id="${type}-wes-variants-${subject}" class="subject-variants-container"&gt;
        &lt;input class="question-id" type="hidden" value="$question"/&gt;
        {{/html}}
        #__gene_table($cpGeneClassName, $cpVariantClassName, {'geneFilters' : [{'propName' : 'subject', 'propValue' : $subject}, {'propName' : 'status', 'propValue' : $geneStatus}], 'variantFilters' : [{'propName' : 'subject', 'propValue' : $subject}, {'propName' : 'status', 'propValue' : $variantStatus}], 'tableIdPrefix' : "${curSubject}-${type}__", 'tableClass' : 'cp-variants', 'mode' : $xcontext.action, 'defaultProperties' : ['cdna', 'interpretation'], 'inputStrings' : ['cdna','protein','transcript','dbsnp','start_position','end_position'], 'displayedProperties' : ['subject', 'status'], 'hasVariants' : true})
      {{html clean="false" wiki="false"}}
      &lt;/div&gt;
      #else
        #if (!$hasNoVariants)##
        &lt;div id="${type}-wes-variants-${subject}" class="subject-variants-container"&gt;
          No variant data entered
        &lt;/div&gt;
        #end##
      #end##
    #end
  &lt;/div&gt;
  #end
#end
##
#macro (__displayVariantsSection)
    &lt;table class="${section}-section table care-pathways-analysis-container"&gt;
      &lt;tr class="care-pathways-modules analysis"&gt;
        &lt;td&gt;
          &lt;div class="table care-pathways-modules-wrapper"&gt;
            #__displayVariantList()##
          &lt;/div&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
#end
##
##
#macro (__displayVariantAnalysis $question)
&lt;div id="primary-variants-interpretation-container"&gt;
{{/html}}##
  #set ($macro.hasContent = false)
  #set ($primaryAnalysisProp = 'primaryVariantAnalysis')
  #if ($xcontext.action == "edit" || "$!{obj.getProperty($primaryAnalysisProp).value}" != '')##
    #set ($macro.hasContent = true)
    #__form_field($primaryAnalysisProp)
  #end
  #if ($xcontext.action == "edit" || "$!{obj.getProperty('genes').value}" != '' &amp;&amp; "$!{obj.getProperty('genes').value}" != '[]')##
    #set ($macro.hasContent = true)
    (% class="geneListField" %) (((
    {{html clean="false" wiki="false"}}&lt;label class="associated-data-field-label"&gt;Name of genes:&lt;/label&gt;{{/html}}
    #__form_field('genes')
    )))
  #end
  #if ($xcontext.action == "edit" || "$!{obj.getProperty('diseases').value}" != '' &amp;&amp; "$!{obj.getProperty('diseases').value}" != '[]')##
    #set ($macro.hasContent = true)
    (% id="diseaseListField" %) (((
    {{html clean="false" wiki="false"}}&lt;label class="associated-data-field-label"&gt;Name of diseases:&lt;/label&gt;{{/html}}
    #__form_field('diseases')
    )))
  #end
  #if ($xcontext.action == 'edit' || "$!{obj.getProperty($primaryAnalysisProp).value}" == 'partially-diagnostic' &amp;&amp; "$!{obj.getProperty('partialDiagnosisExplanation').value}" != '')
    #set ($macro.hasContent = true)
    (% id="partialDiagnosisExplanationField" %) (((
    {{html clean="false" wiki="false"}}&lt;label class="associated-data-field-label"&gt;Explanation for Partial Diagnosis:&lt;/label&gt;{{/html}}
    #__form_field('partialDiagnosisExplanation')
    )))
  #end
  #if (!$macro.hasContent)
    {{html clean="false" wiki="false"}}&lt;span class="displayed-value"&gt;No data entered&lt;/span&gt;{{/html}}
  #end
{{html clean="false" wiki="false"}}##
&lt;/div&gt;
#end
#macro (__displayVariantsAnalysisSection)
    &lt;table class="${section}-section module-analysis table care-pathways-analysis-container"&gt;
      &lt;tr class="care-pathways-modules analysis"&gt;
        &lt;td&gt;
          &lt;div class="table care-pathways-modules-wrapper"&gt;
            #__displayVariantAnalysis("CPQ:17")##
          &lt;/div&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
#end
##
##
#macro(__buildCategoryModuleViewMode $module $question $variantNumber $storedValues)
  &lt;tr class="table-row care-pathways-module-container-view"&gt;
    &lt;td class="table-cell selector-panel cp-current-selection"&gt;
        #if ($module.module == 'timeline')
          #macro(__displayViewDate $propertyName $className)
            #set ($date = $doc.display($propertyName, $doc.getObject($className)).replaceAll('(\{\{html clean="false" wiki="false"\}\})|(\{\{/html\}\})', '').replaceAll('^&lt;p&gt;|&lt;/p&gt;$', ''))
            #if ("$!date" != '')
              &lt;tr class="${module.module}_field category-data"&gt;
                &lt;td&gt;
                  &lt;table class="summary-group parent-summary-group"&gt;
                    &lt;tr class="term-holder"&gt;
                      &lt;td&gt;&lt;span class="term-data"&gt;&lt;label class="label-field"&gt;${doc.displayPrettyName($propertyName, $doc.getObject($className))}: ${date}&lt;/label&gt;&lt;/span&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                  &lt;/table&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
            #end
          #end
          &lt;table class="terms-data-table"&gt;
          #if ($module.submodule == 'pretest')
            #set ($content = "
              #__displayViewDate('date_of_birth', 'PhenoTips.PatientClass')
              #__displayViewDate('symptom_onset', 'PhenoTips.CarePathwaysTimelineSheet')
              #__displayViewDate('symptom_onset_age', 'PhenoTips.CarePathwaysTimelineSheet')
              #__displayViewDate('referral_to_genetics_date', 'PhenoTips.CarePathwaysTimelineSheet')
              #__displayViewDate('last_genetic_consult_date', 'PhenoTips.CarePathwaysTimelineSheet')
            ")
          #elseif ($module.submodule == 'posttest')
            #set ($content = "
              #__displayViewDate('laboratory', 'PhenoTips.CarePathwaysTimelineSheet')
              #__displayViewDate('moh_submission_date', 'PhenoTips.CarePathwaysTimelineSheet')
              #__displayViewDate('moh_approval_date', 'PhenoTips.CarePathwaysTimelineSheet')
              #__displayViewDate('sample_sent_date', 'PhenoTips.CarePathwaysTimelineSheet')
              #__displayViewDate('lab_report_date', 'PhenoTips.CarePathwaysTimelineSheet')
              #__displayViewDate('result_reported_date', 'PhenoTips.CarePathwaysTimelineSheet')
            ")
          #end
          #if ("$!content.trim()" != '')
            $content
          #else
            &lt;tr&gt;&lt;td class="no-data"&gt;No data entered&lt;/td&gt;&lt;/tr&gt;
          #end
          &lt;/table&gt;
        #elseif ($module.module == 'Eligibility')
          &lt;div class="eligibility"&gt;$doc.display($module.submodule).replaceAll('(\{\{html clean="false" wiki="false"\}\})|(\{\{/html\}\})', '').replaceAll('^&lt;p&gt;|&lt;/p&gt;$', '').replaceAll('\|', '&lt;br/&gt;')&lt;/div&gt;
        #elseif ($module.module == 'variants')
          #if ($module.submodule == 'analysis')
            #__displayVariantsAnalysisSection()
          #else
            #__displayVariantsSection()
          #end
        #elseif ($module.module == "relatives")
          #set ($content = "
            #__displayRow(""firstDegreeCounselling${stringtool.capitalize($module.submodule)}"")
            #__displayRow(""secondDegreeCounselling${stringtool.capitalize($module.submodule)}"")
            #__displayRow(""firstDegreeTesting${stringtool.capitalize($module.submodule)}"")
            #__displayRow(""secondDegreeTesting${stringtool.capitalize($module.submodule)}"")
          ")
          #if ("$!content.trim()" != '')
            &lt;dl&gt;$content&lt;/dl&gt;
          #end
        #elseif ($module.module == "followUp")
          &lt;dl&gt;
            #foreach ($q in ['additionalDiagnosticTestingOrdered', 'additionalDiagnosticTestingAvoided', 'specificTreatmentRecommended', 'specificTreatmentStopped', 'specificSurveillanceRecommended', 'specificSurveillanceStopped', 'cascadeTestingRecommended', 'prenatalDiagnosisDiscussed'])
              #__displayRow($q)
            #end
          &lt;/dl&gt;
        #elseif ($module.module == "sequencing")
          &lt;table class="terms-data-table"&gt;
          &lt;tr&gt;
            &lt;td class="no-data"&gt;&lt;span&gt;$doc.display('sequencingStrategy', $doc.getObject('PhenoTips.CarePathwaysPostTestSheet')).replaceAll('(\{\{html clean="false" wiki="false"\}\})|(\{\{/html\}\})', '').replaceAll('^&lt;p&gt;|&lt;/p&gt;$', '')&lt;/span&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;/table&gt;
        #elseif($storedValues.size() == 0 || $module.noneOption &amp;&amp; $doc.getValue($module.noneOption))##
          &lt;table class="terms-data-table"&gt;
          &lt;tr&gt;
            &lt;td class="no-data"&gt;&lt;span&gt;#if ($module.noneOption &amp;&amp; $doc.getValue($module.noneOption))None#{else}No data entered#end&lt;/span&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;/table&gt;
        #else##
          &lt;table class="terms-data-table"&gt;
          #foreach($category in $storedValues.keySet())##
            #set ($categoryData = $storedValues.get($category))##
            &lt;tr class="${module.module}_field category-data"&gt;
              &lt;td&gt;
                &lt;table class="summary-group parent-summary-group"&gt;
                  &lt;tr class="term-holder"&gt;
                    &lt;td&gt;&lt;span class="term-data"&gt;&lt;label class="label-field"&gt;${categoryData.label}&lt;/label&gt;&lt;/span&gt;&lt;/td&gt;
                  &lt;/tr&gt;
                  &lt;tr&gt;
                    &lt;td class="dialog-holder"&gt;
                      #__displaySummaryItems($categoryData, $displayedData, $!{module.module})
                    &lt;/td&gt;
                  &lt;/tr&gt;
                &lt;/table&gt;
              &lt;/td&gt;
            &lt;/tr&gt;
          #end##
          &lt;/table&gt;
        #end##
    &lt;/td&gt;
  &lt;/tr&gt;
#end
##
##
#macro(__displaySummaryItems $categoryData $displayedData $moduleType)
  #set ($qualifiers = $categoryData.qualifiers)##
  #foreach($qualifier in $qualifiers)##
    #set ($macro.hasData = false)
    #foreach($key in ['datum', 'laboratory', 'date_pursued', 'date_recommended', 'notes', 'pursued'])##
      #if ("$!qualifier.get($key)" != '')
        #set ($macro.hasData = true)
        #break
      #end
    #end
  #if ($macro.hasData)
  &lt;div class="summary-item"&gt;
    &lt;div class="term-details"&gt;
      &lt;dl&gt;
        #foreach($key in $qualifier.keySet())##
          #set ($keyValue = $qualifier.get($key))##
          #set ($keyLabel = "$!{services.vocabularies.care-pathways.getTerm($keyValue).name}")
          #set ($displayedData = {
            "laboratory" :
              {
                "displayedName" : $!escapetool.xml($services.localization.render("phenotips.carePathways.detailsDialog.laboratory.title"))
              },
            "location" :
              {
                "displayedName" : $!escapetool.xml($services.localization.render("phenotips.carePathways.detailsDialog.location.title"))
              },
            "date_pursued_fuzzy" :
              {
                "displayedName" : $!escapetool.xml($services.localization.render("phenotips.carePathways.${moduleType}.detailsDialog.datePicker.date_pursued.title")),
                "displayedValue" : "#__displayDate($keyValue)"
              },
            "date_recommended_fuzzy" :
              {
                "displayedName" : $!escapetool.xml($services.localization.render("phenotips.carePathways.${moduleType}.detailsDialog.datePicker.date_recommended.title")),
                "displayedValue" : "#__displayDate($keyValue)"
              },
            "pursued" :
              {
                "displayedName" : 'Pursued within 1 year?',
                "displayedValue" : "#if ($qualifier.get('pursued') == 1)Yes#elseif ($qualifier.get('pursued') == 0)No#end"
              },
            "datum" :
              {
                "displayedName" : $!escapetool.xml($services.localization.render("phenotips.carePathways.detailsDialog.datum.title")),
                "displayedValue" : "#if($!{keyLabel} != '')$!{keyLabel}#{else}$keyValue#{end}"
              },
            "notes" :
              {
                "displayedName" : $!escapetool.xml($services.localization.render("phenotips.carePathways.detailsDialog.notes.title"))
              },
            "subject" :
              {
                "displayedName" : $!escapetool.xml($services.localization.render("phenotips.carePathways.detailsDialog.subject.title")),
                "displayedValue" : "#if($keyValue != 'proband')$!{keyValue}#{end}"
              }
          })##
          #set ($itemSettings = $displayedData.get($key))
          #if ($itemSettings)##
            #set ($mappedVal = $!{itemSettings.displayedValue})
            #set ($displayedVal = "#if($mappedVal)$!{mappedVal}#{else}$!{keyValue}#{end}")##
            #if ($displayedVal != '')##
              #set ($displayedName = "$!{itemSettings.displayedName}")##
              &lt;dt class="$key#if($!{displayedName} == '') hidden#{end}"&gt;${displayedName}&lt;/dt&gt;
              &lt;dd class="$key"&gt;${displayedVal}&lt;/dd&gt;
            #end##
          #end##
        #end##
      &lt;/dl&gt;
      &lt;div class="clearfloats"&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  #end## qualifier has data
  #end## foreach qualifier
#end
##
##
#macro(__buildCategoryModuleEditMode $module $question $variantNumber $storedValues)
  #set ($curSubject = $!{module.get('subject')})
  #set ($moduleName = $!{module.get('module')})
  #set ($curSubmodule = $!{module.get('submodule')})
  #set ($dates = $!{module.get('dates')})
  #set ($withDates = "#if($!dates &amp;&amp; $!{dates.size()}) with-mandatory-dates#{end}")
  #set ($associatedVariantType = $!{module.get('type')})
  &lt;tr class="table-row care-pathways-module-container$!{withDates}"&gt;
    &lt;td class="table-cell selector-panel cp-categories"#if ($module.type == '1block') colspan="2"#{end}&gt;
      #if ($module.type != '1block')
        &lt;h3&gt;&lt;span&gt;&lt;strong&gt;Categories&lt;/strong&gt;&lt;/span&gt;&lt;/h3&gt;
      #end
      &lt;div class="cp-categories-panel browse-categories-panel"&gt;
        #__displayModule($module, "$!{question}", "$!{variantNumber}", $storedValues)
      &lt;/div&gt;
      #if ($module.type != '1block')
    &lt;/td&gt;
    &lt;td class="table-cell selector-panel cp-current-selection"&gt;
        &lt;h3&gt;&lt;span&gt;&lt;strong&gt;Current selection&lt;/strong&gt;&lt;/span&gt;&lt;/h3&gt;
      &lt;div class="cp-current-selection-panel current-selection-panel" name="$!{question}"&gt;
        &lt;input type="hidden" name="moduleType" value="$!{moduleName}"/&gt;
        &lt;input type="hidden" class="associated-variant-type" value="$!{associatedVariantType}"/&gt;
        &lt;input type="hidden" class="associated-variant-number" value="$!{variantNumber}"/&gt;
        &lt;input type="hidden" class="cp-current-selection-subject" value="$!{curSubject}"/&gt;
        &lt;input type="hidden" class="cp-current-selection-dates" value="$!{escapetool.xml($jsontool.serialize($dates))}"/&gt;
        &lt;input type="hidden" class="cp-current-selection-pursued" value="$!{escapetool.xml($module.hasPursued)}"/&gt;
        &lt;input type="hidden" class="cp-current-selection-stored-data" value="$!{escapetool.xml($jsontool.serialize($storedValues))}"/&gt;
        &lt;table class="terms-data-table"&gt;&lt;/table&gt;
      &lt;/div&gt;
      #end
    &lt;/td&gt;
  &lt;/tr&gt;
#end
##
##
#macro(__getStoredValues $questionId $subject $module $type $variantNumber $categories $qualifierClassName)
  #set ($qualifierObjects = $doc.getObjects($qualifierClassName, 'question', $questionId))
  #if ($qualifierObjects)
    #foreach ($q in $qualifierObjects)
      #if (($subject == '' || $q.getProperty('subject').value == $subject) &amp;&amp; ($type == '' || $q.getProperty('type').value == $type) &amp;&amp; ($variantNumber == '' || "$!{q.getProperty('variant').value}" == "$!{variantNumber}") &amp;&amp; ($module == '' || $q.getProperty('module').value == $module))
        #set ($storedDatum = {})
        #set ($parent = "$!{q.getProperty('parent').value}")
        #set ($label = "#__buildLabelPath($parent)")
        #set ($discard = $categories.putIfAbsent($parent, {"id" : $parent, "label" : $label, "affected" : true, "qualifiers" : []}))
        #set ($categoryItems = $categories.get($parent).get("qualifiers"))
        #foreach($prop in $q.xWikiClass.properties)
          #if ($prop.name != "date_pursued_fuzzy" &amp;&amp; $prop.name != "date_recommended_fuzzy")
            #set ($discard = $storedDatum.put($prop.name, "$!{q.getProperty($prop.name).value}"))
          #else
            #set ($discard = $storedDatum.put($prop.name, $jsontool.parseToJSONObject($stringtool.defaultIfBlank("$!{q.getProperty($prop.name).value}", "{}"))))
          #end
        #end
        #set ($discard = $storedDatum.put("count", $q.number))
        #set ($discard = $categoryItems.add($storedDatum))
      #end
    #end
  #end
#end
##
##
#macro(__buildLabelPath $test)
  #if (!$termsExcludedFromPath.contains($test))##
    #set ($node = $!{services.vocabularies.care-pathways.getTerm($test)})##
    #if ($node)##
      #set ($macro.accumulatedPath = "$!{node.name}")##
      #if ($node.is_a &amp;&amp; $node.is_a.size() &gt; 0)##
        #set ($nodeId = $node.is_a.get(0))##
        #set ($prefix = "#__buildLabelPath($nodeId)")##
        #set ($macro.accumulatedPath = "#if($!{prefix} != '')$!{prefix} » #{end}$!{macro.accumulatedPath}")##
      #end##
    #else##
      #set ($nodeId = "$stringtool.substringBefore($test, '_other')")##
      #if ($!{services.vocabularies.care-pathways.getTerm($nodeId)})##
        #set ($prefix = "#__buildLabelPath($nodeId)")##
        #set ($macro.accumulatedPath = "#if($!{prefix} != '')$!{prefix} » #{end}Other")##
      #end##
    #end##
    $!{macro.accumulatedPath}##
  #end##
#end##
##
##
#macro (__displayChildren $submoduleName $term $childrenList $question $storedValues $justCategories)
  #set($allChildren = $services.vocabularies.care-pathways.search({'term_category': $term}, {'sort': 'nameSort asc'}))
  #set($macro.numChildren = $childrenList.size())
  #set($macro.expectedNumChildren = $allChildren.size())
  #if ($macro.numChildren &gt; 0)
    #set ($macro.accumulated = "")
    #foreach($item in $childrenList)
      #set ($childrenHtml = "#__displayChildren($submoduleName, $item.id, $services.vocabularies.care-pathways.search({'is_a': $item.id}, {'sort': 'nameSort asc'}), $question, $storedValues, $justCategories)")
      #if ("$!{childrenHtml}" != "")
        #set ($itemName = "$!{item.name}")
        #if ($stringtool.trim("$!{childrenHtml}") != "")
          #set ($otherKey = $stringtool.join([$item.id, '_other'], ''))##
          #set ($macro.accumulated = "${macro.accumulated}&lt;li class='term-entry'&gt;&lt;input class='term-id' type='hidden' value='$!{item.id}'&gt;&lt;label&gt;&lt;span id='cp-expand-tool-${module}-${question}-${item.id}${variantStub}' class='expand-tool fa fa-caret-right'&gt;&lt;/span&gt;&lt;span class='term-name'&gt;$!{itemName}&lt;/span&gt;&lt;/label&gt;&lt;ul&gt;${childrenHtml}&lt;li class='term-entry custom'&gt;&lt;input class='parent-id' type='hidden' value='$!{item.id}'&gt;&lt;label for='cp-add-tool-${module.module}-${question}-${item.id}${variantStub}_other'&gt;&lt;input id='cp-add-tool-${module.module}-${question}-${item.id}${variantStub}_other' class='add-tool' type='checkbox' #if($storedValues.containsKey($otherKey))checked#{end}&gt;&lt;input class='submodule-name' type='hidden' value='${submoduleName}'&gt;&lt;span class='term-name'&gt;Other&lt;/span&gt;&lt;/label&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;")
        #else
          #set ($macro.accumulated = "${macro.accumulated}&lt;li class='term-entry'&gt;&lt;input class='term-id' type='hidden' value='$!{item.id}'&gt;&lt;label for='cp-add-tool-${module}-${question}-${item.id}${variantStub}'&gt;&lt;input id='cp-add-tool-${module}-${question}-${item.id}${variantStub}' name='$!{item.id}' class='add-tool' type='checkbox' #if($storedValues.containsKey($item.id))checked#{end}&gt;&lt;input class='submodule-name' type='hidden' value='${submoduleName}'&gt;&lt;span class='term-name'&gt;$!{itemName}&lt;/span&gt;&lt;/label&gt;&lt;/li&gt;")
        #end
      #elseif ("$!{childrenHtml}" == "" &amp;&amp; ($macro.expectedNumChildren &gt; $macro.numChildren || $justCategories))
        #set ($macro.accumulated = "${macro.accumulated}&lt;li class='term-entry'&gt;&lt;input class='term-id' type='hidden' value='$!{item.id}'&gt;&lt;label for='cp-add-tool-${module.module}-${question}-${item.id}${variantStub}'&gt;&lt;input id='cp-add-tool-${module.module}-${question}-${item.id}${variantStub}' name='$!{item.id}' class='add-tool' type='checkbox' #if($storedValues.containsKey($item.id))checked#{end}&gt;&lt;input class='submodule-name' type='hidden' value='${submoduleName}'&gt;&lt;span class='term-name'&gt;$!{item.name}&lt;/span&gt;&lt;/label&gt;&lt;/li&gt;")
      #end
    #end
    $macro.accumulated
  #end
#end
##
##
#macro (__displayCategories $submoduleName $rootNode $rootChildren $question $storedValues $justCategories)
  #if ($module.noneOption)
  &lt;div class="controlled-group"&gt;
  &lt;label class="controller exclude"&gt;&lt;input type="checkbox" name="PhenoTips.CarePathwaysPreTestSheet_0_${module.noneOption}" value="1"#if ($doc.getValue($module.noneOption)) checked="checked"#end /&gt; None&lt;/label&gt;
  &lt;ul class="controlled cp-module-$!module.module cp-submodule-$!module.submodule"&gt;
  #else
  &lt;ul class="cp-module-$!module.module cp-submodule-$!module.submodule"&gt;
  #end
    #__displayChildren($submoduleName, $rootNode, $rootChildren, $question, $storedValues, $justCategories)
  #if ($module.module == 'care' &amp;&amp; $section == 'posttest')
    #if ($question == 'CPQ:22')
      #__displayChildren($submoduleName, 'CP:08', ${services.vocabularies.care-pathways.search({'is_a': 'CP:08'}, {'sort': 'nameSort asc'})}, $question, $storedValues, true)
    #end
    #__displayChildren($submoduleName, 'CP:09', [$services.vocabularies.resolveTerm('CP:99')], $question, $storedValues, true)
  #end
  #if ($module.otherEnabled)
    #set ($otherId = $stringtool.join([$rootNode, '_other'], ''))##
    &lt;li class='term-entry custom'&gt;&lt;input class='parent-id' type='hidden' value='$!{rootNode}'&gt;&lt;label for='cp-add-tool-${module.module}-${question}-${rootNode}${variantStub}_other'&gt;&lt;input id='cp-add-tool-${module.module}-${question}-${rootNode}${variantStub}_other' class='add-tool' type='checkbox' #if($storedValues.containsKey($otherId))checked#{end}&gt;&lt;span class='term-name'&gt;Other&lt;/span&gt;&lt;/label&gt;&lt;/li&gt;
  #end
  &lt;/ul&gt;
  #if ($module.noneOption)
  &lt;/div&gt;
  #end
#end
##
##
#macro (__displayModule $module $question $variantNumber $storedValues)
  #set ($variantStub = "#if($variantNumber != '')-${variantNumber}#{end}")
  #if ($module.module == "test")
    #__displayCategories($module.submodule, $testTerm, ${services.vocabularies.care-pathways.search({'is_a': $testTerm}, {'sort': 'nameSort asc'})}, $question, $storedValues, true)
  #elseif ($module.module == "care")
    #__displayCategories("", $careTerm, $services.vocabularies.care-pathways.search({'is_a': $careTerm}, {'sort': 'nameSort asc'}), $question, $storedValues, true)
  #elseif ($module.module == "Eligibility")
    &lt;div class="eligibility"&gt;$doc.display($module.submodule).replaceAll('(\{\{html clean="false" wiki="false"\}\})|(\{\{/html\}\})', '').replaceAll('^&lt;p&gt;|&lt;/p&gt;$', '')&lt;/div&gt;
  #elseif ($module.module == "relatives")
    &lt;dl&gt;
      #__displayRow("firstDegreeCounselling${stringtool.capitalize($module.submodule)}")
      #__displayRow("secondDegreeCounselling${stringtool.capitalize($module.submodule)}")
      #__displayRow("firstDegreeTesting${stringtool.capitalize($module.submodule)}")
      #__displayRow("secondDegreeTesting${stringtool.capitalize($module.submodule)}")
    &lt;/dl&gt;
  #elseif ($module.module == "followUp")
    &lt;dl&gt;
      #foreach ($q in ['additionalDiagnosticTestingOrdered', 'additionalDiagnosticTestingAvoided', 'specificTreatmentRecommended', 'specificTreatmentStopped', 'specificSurveillanceRecommended', 'specificSurveillanceStopped', 'cascadeTestingRecommended', 'prenatalDiagnosisDiscussed'])
        #__displayRow($q)
      #end
    &lt;/dl&gt;
  #elseif ($module.module == "sequencing")
    $doc.display('sequencingStrategy', $doc.getObject('PhenoTips.CarePathwaysPostTestSheet')).replaceAll('(\{\{html clean="false" wiki="false"\}\})|(\{\{/html\}\})', '').replaceAll('^&lt;p&gt;|&lt;/p&gt;$', '')
  #elseif ($module.module == 'variants')
    #if ($module.submodule == 'analysis')
      #__displayVariantsAnalysisSection()
    #else
      #__displayVariantsSection()
    #end
  #elseif ($module.module == "timeline")
    &lt;div class="timeline"&gt;
    #set($timelineObject = $doc.getObject('PhenoTips.CarePathwaysTimelineSheet', true))
    #set($timelineClass = $timelineObject.xWikiClass)
    #set($patientObj = $doc.getObject('PhenoTips.PatientClass'))
    #set($patientClass = $patientObj.xWikiClass)
    #set($discard = $doc.use($patientObj))
    #set($prevClass= $class)
    #set($class = $patientClass)
    #macro (__displayDateRow $propName $mandatory)
      &lt;dt class="date $propName#if($mandatory) mandatory-date#{end}"&gt;
      {{/html}}

      #__label($propName "" "")##
      {{html clean="false" wiki="false"}}##
      &lt;/dt&gt;
      &lt;dd class="date $propName#if($mandatory) mandatory-date#if ($module.submodule == 'posttest') mandatory-date-full#{end}#{end}"&gt;
      {{/html}}
      #__display($propName)
      {{html clean="false" wiki="false"}}##
      &lt;/dd&gt;
    #end

    #if ($module.submodule == 'pretest')
    &lt;dl style="margin: 1em 0 1em 2em"&gt;
    &lt;dt&gt;
    {{/html}}##
    #__label('date_of_birth' "" "")##
    {{html clean="false" wiki="false"}}
    &lt;/dt&gt;
    &lt;dd&gt;
    {{/html}}
    #set($display = $patientObj.display('date_of_birth', $xcontext.action))
    (% class="displayed-value"%)(((
    #if ($xcontext.action == 'edit' || "$!{display}" != "")
      $display
    #else
      -
    #end
    )))
    {{html clean="false" wiki="false"}}##
    &lt;/dd&gt;
    #set($discard = $doc.use($timelineObject))
    #set($class = $timelineClass)
    #__displayDateRow("symptom_onset", true)##
    #__displayDateRow("symptom_onset_age", true)##
    #__displayDateRow("referral_to_genetics_date", true)##
    #__displayDateRow("last_genetic_consult_date", true)##
    &lt;/dl&gt;
    #elseif ($module.submodule == 'posttest')
      #set($discard = $doc.use($timelineObject))
      #set($class = $timelineClass)
      #__displayDateRow("laboratory", true)##
      #__displayDateRow("moh_submission_date", true)##
      #__displayDateRow("moh_approval_date", true)##
      #__displayDateRow("sample_sent_date", true)##
      #__displayDateRow("lab_report_date", true)##
      #__displayDateRow("result_reported_date", true)##
    #end
    &lt;/div&gt;
    #set ($discard = $doc.use($obj))
    #set ($class = $prevClass)
  #end
#end
{{/velocity}}

{{velocity filter="indent"}}
#if ($xcontext.action == 'get')
  #if ("$!{request.modules}" != '')##
    {{html clean="false" wiki="false"}}##
    #set($modulesObj = $jsontool.parseToJSONArray(${request.modules}))
    #set ($lastIdx = $modulesObj.length() - 1)
    #__displayModuleGroup("$!{request.question}", "$!{request.variantNumber}", "$!{request.groupTitle}", $modulesObj, ${lastIdx}, "$!{request.tab}", "$!{request.storageClass}", false, true)
    {{/html}}
  #end
#end
{{/velocity}}</content>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>0</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>e35d82ae-f12e-4fae-a07b-5d3c5935ef5b</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>var PhenoTips = (function(PhenoTips) {
  var widgets = PhenoTips.widgets = PhenoTips.widgets || {};
  // Care Pathways.
  var cp = widgets.carePathways = widgets.carePathways || {};
  cp.CPDetailsDialog = Class.create(widgets.DetailsDialog, {
    initialize : function($super, termID, dataName, parentContainer, qualifierCount, qualifierDataClass) {
      $super(termID, dataName, parentContainer, qualifierCount, qualifierDataClass);
      this.getDialog().__validate = this._validate.bind(this);
    },

    withHiddenDataElement : function(options) {
      var spanElem = new Element('span');
      var inputSourceClass = options ? options.inputSourceClass : "";
      var hiName = (this._qualifierDataClass &amp;&amp; options.qualifierName)
        ? this._qualifierDataClass + this._globalCount + "_" + options.qualifierName
        : this._dataName + '_' + this._elementID + '_' + options.qualifierName;
      var hiddenInput = new Element('input', {'type' : 'hidden', 'name' : hiName, 'class' : inputSourceClass});
      hiddenInput.value = (options.hiddenDataValue != null &amp;&amp; options.hiddenDataValue != undefined) ? options.hiddenDataValue : "";
      spanElem.insert(hiddenInput);
      spanElem._getValue = function() { return hiddenInput.value; };
      spanElem._setValue = function(value) { hiddenInput.value = value; };
      spanElem._addValue = function(values) { options.qualifierName &amp;&amp; (values[options.qualifierName] = hiddenInput.value); };
      return this.withSimpleDataElement(spanElem, options);
    },

    withTypeAhead : function (collapsible, options) {
      options = options || {};
      var inputSourceClass = options.inputSourceClass || "";
      var data = options.data || {};
      var spanElem = new Element('span', {'class': 'scrollable-typeahead'});
      var inputElem = new Element('input', {'class' : inputSourceClass + ' ' + 'typeahead', 'type' : 'text', 'placeholder' : options.placeholder || ''});

      spanElem.insert(inputElem);
      var _this = this;
      this._initTypeAhead(spanElem, inputElem, data, options);
      options.inline = 'inline';
      this._qualifierDataClass &amp;&amp; options.qualifierName
        &amp;&amp; this._setPhenoTipsTypeAheadInputFormData(spanElem, inputElem, options.displayedToStoredMapper, this._qualifierDataClass + this._globalCount
        + "_", options.qualifierName);
      return this.withQualifierElement(spanElem, collapsible, options);
    },

    withSimpleDataElement : function(element, options) {
      var defListItemClass = options.defListItemClass || "";
      var qualifierLabel = options.qualifierLabel || "";
      var qualifierName = options.qualifierName || "";
      var dtElem = new Element('dt');
      var ddElem = new Element('dd');
      dtElem.addClassName(defListItemClass);
      ddElem.addClassName(defListItemClass);
      qualifierLabel &amp;&amp; dtElem.insert('&lt;label&gt;' + qualifierLabel + '&lt;/label&gt;');
      ddElem.insert(element);
      this._qualifierList.insert(dtElem).insert(ddElem);
      qualifierName &amp;&amp; (this._qualifierMap[qualifierName] = element);
      element._toggleSummarize = function() {};
      return this;
    },

    blur : function($super) {
      this._isValid() &amp;&amp; $super();
    },

    _validate : function() {
      var valid = this._isValid();
      !valid &amp;&amp; this.focus();
      return valid;
    },

    _isValid : function(dialog) {
      var dialog = this.getDialog();
      var valid = true;
      if (dialog.__validated_Elems) {
        var valid = LiveValidation.massValidate(dialog.__validated_Elems.map(function(x) { return x.__validation; }));
      }
      return valid;
    },

    _attachOnDeleteListener : function ($super, deleteAction, ajaxDeleteAction) {
      var _this = this;
      var deleteElements = function() {
        _this._termDetails.select('.mandatory :input:not([type="hidden"])', '.mandatory-date input.fuzzy-date').each(function(validatedElem) {
          validatedElem.__validation.destroy();
        });
        _this._termDetails.remove();
        _this._qualifierMap = {};
        Event.fire(_this._container, _this._dataName + ':dialog:deleted', {'id' : _this._elementID});
      };
      deleteAction.observe('click', function () {
        if (ajaxDeleteAction) {
        var url =  ajaxDeleteAction.replace(/([&amp;?]classid=)(xXx__COUNT_TEMPLATE__xXx)([&amp;$])/, "$1" + _this._globalCount + "$3");
        _this._sendRemoveRequest(deleteAction, url, deleteElements);
        } else {
          deleteElements();
        }
      });
    },

    _initTypeAhead : function(spanElem, inputElem, data, options) {
      var _this = this;
      var userEntered = options.remote ? new Bloodhound({
          datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
          queryTokenizer: Bloodhound.tokenizers.whitespace,
          prefetch: options.remote + '',
          remote: {
            url: options.remote + '%QUERY',
            wildcard: '%QUERY'
          }
      }) : [];
      var typeaheadEl = jQuery(inputElem).typeahead(
        {
          minLength: options.minLength || 0,
          highlight: true,
          hint: true
        },
        {
          name: 'presets',
          source: _this._typeAheadMatcher(data),
          limit: options.limit || 20
        },
        {
          name: 'user-entered',
          source: userEntered,
          display: 'name',
          limit: options.limit || 20,
          templates: { header: '&lt;h3 class="user-entered-data"&gt;Custom options entered by other users&lt;/h3&gt;' }
        }
      );
      spanElem._getValue = _this._defaultGetInputValueFx(typeaheadEl);
      spanElem._setValue = _this._setInputValueFx(inputElem, options.storedToDisplayedMapper);
      spanElem._addValue = _this._addSimpleValueFx(spanElem, options.qualifierName, options.displayedToStoredMapper);
    },

    /**
     * A function for retrieving the input value from the element.
     *
     * @return {Function} a function for retrieving the input value
     * @private
     */
    _defaultGetInputValueFx : function (inputEl) {
      return function () {
        var inputVal = inputEl.typeahead('val');
        return inputVal ? inputVal : "";
      };
    },

    _typeAheadMatcher : function(data) {
      return function (query, sync) {
        if (query === '') {
          sync(data);
        } else {
          var matches, substrRegex;
          // an array that will be populated with substring matches
          matches = [];

          // regex used to determine if a string contains the substring `query`
          substrRegex = new RegExp(query, 'i');

          // iterate through the pool of strings and for any string that
          // contains the substring `query`, add it to the `matches` array
          data.each(function(item) {
            if (substrRegex.test(item)) {
              matches.push(item);
            }
          });
          sync(matches);
        }
      };
    },

    /**
     * A function for setting an input element value.
     *
     * @param inputEl the input element
     * @param valueMapperFx the custom value mapper function; null if value should be used as is
     * @return {Function} a function for setting the provided value in for the input
     * @private
     */
    _setInputValueFx : function (inputEl, valueMapperFx) {
      return function (value) {
        var mappedVal = valueMapperFx ? valueMapperFx(value) : value;
        jQuery(inputEl).typeahead('val', mappedVal);
        var parentEl = inputEl.up('span.scrollable-typeahead');
        var hiddenInput = parentEl &amp;&amp; parentEl.down('input[type="hidden"].stored-string-input-val');
        hiddenInput &amp;&amp; (hiddenInput.value = value);
      };
    },

    /**
     * A function for adding an input element value to the summary {Object}.
     *
     * @param element the parent element holding the input element
     * @param qualifierName the user-provided qualifier name
     * @param valueMapperFx the custom value mapper function; null if value should be used as is
     * @return {Function} a function for adding the input element value to the summary {Object}
     * @private
     */
    _addSimpleValueFx : function (element, qualifierName, valueMapperFx) {
      return function (values) {
        if (qualifierName) {
          values[qualifierName] = valueMapperFx ? valueMapperFx(element._getValue()) : element._getValue();
        }
      };
    },

    _setPhenoTipsTypeAheadInputFormData : function(spanElem, inputElem, toStored, qualifierClass, qualifierName) {
      var inputHiddenElem = new Element('input', {'class': 'stored-string-input-val', 'type': 'hidden'});
      spanElem.insert(inputHiddenElem);
      var formattedVal = function () { return toStored ? toStored(spanElem._getValue()) : spanElem._getValue(); };

      this._setInput(inputHiddenElem, formattedVal(), qualifierClass + qualifierName);
      var _this = this;
      var typeaheadEl = jQuery(inputElem);
      var menu = typeaheadEl.data('ttTypeahead').menu;

      inputElem.observe('blur', function(event) {
        // On blur, check if item is a selection (typeahead:selected event isn't triggered if user entered matching input and clicked away).
        var suggestionElems = inputElem.next("div.tt-menu").select("div.tt-suggestion");
        var enteredVal = typeaheadEl.typeahead('val');
        var matched = false;
        suggestionElems &amp;&amp; suggestionElems.each(function(elem) {
          var item = menu.getSelectableData(jQuery(elem));
          var suggestedVal = item.val;
          if (suggestedVal &amp;&amp; (suggestedVal.toLowerCase() === (enteredVal &amp;&amp; enteredVal.toLowerCase()))) {
            typeaheadEl.typeahead('val', suggestedVal);
            matched = true;
            throw $break;
          }
        });
        _this._setInput(inputHiddenElem, formattedVal(), null);
        Event.fire(_this._container, "cp:typeahead:" + (matched ? "selected" : "custom"), {'id' : _this._elementID, 'selected' : formattedVal(), 'dialog' : _this._termDetails});
      });
    }
  });

  return PhenoTips;
}(PhenoTips || {}));</code>
    </property>
    <property>
      <name>Modified DetailsDialog widget</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>1</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>6ae5459b-6ff6-4199-bb41-79eca9bb4eb9</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>var PhenoTips = (function(PhenoTips) {
  var widgets = PhenoTips.widgets = PhenoTips.widgets || {};
  // Care Pathways.
  var cp = widgets.carePathways = widgets.carePathways || {};
  cp.CPDetailsDialogGroup = Class.create(widgets.DetailsDialogGroup, {
    _addDialog : function (count) {
      var qualifierCount = (count != null &amp;&amp; count != undefined) ? count : this._qualifierNo;
      var dialog = new PhenoTips.widgets.carePathways.CPDetailsDialog(this._termID, this._dataName, this._dialogHolder, qualifierCount, this._qualifierDataClass).attach();
      // Count the number of qualifiers for current term, regardless.
      this._qualifierNo++
      return dialog;
    },

    dialogsAddTypeAhead : function (collapsible, options) {
      var addTypeAhead = function (currentDialog) {
        currentDialog.withTypeAhead(collapsible, options);
      };
      this._dialogOptions.push(addTypeAhead);
      return this;
    },

    dialogsAddHiddenDataElement : function (options) {
      var addHiddenDataElement = function (currentDialog) {
        currentDialog.withHiddenDataElement(options);
      };
      this._dialogOptions.push(addHiddenDataElement);
      return this;
    },

    _clearDetails: function($super) {
      this._dialogHolder.select('.mandatory :input:not([type="hidden"])', '.mandatory-date input.fuzzy-date').each(function(validatedElem) {
        validatedElem.__validation.destroy();
      });
      $super();
    },

    _setQualifiers : function ($super, qualifiers, silent) {
      var _this = this;
      var elements = [];
      qualifiers.forEach(function (qualifier) {
        var dialog = _this.addDialog(silent, qualifier.count).setValues(qualifier);
        dialog.blur();
        elements.push(dialog.getDialog());
      });
      this._allowMultiDialogs &amp;&amp; this._addDetailsClickListener();
      elements.size() &amp;&amp; this.get().fire("detailsDialogGroup:dialogs:added", {"elements" : elements});
    }
  });

  // End PhenoTips augmentation.
  return PhenoTips;
}(PhenoTips || {}));</code>
    </property>
    <property>
      <name>Modified DetailsDialogGroup widget</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>2</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>5651adc7-a499-42a1-b74c-1e45751b090d</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>var PhenoTips = (function(PhenoTips) {
  var widgets = PhenoTips.widgets = PhenoTips.widgets || {};
  // Care Pathways.
  var cp = widgets.carePathways = widgets.carePathways || {};

  cp.ModuleNavigationPanel = Class.create({
    initialize : function(container, options) {
      if (!container) { return; }
      this._container = container;
      this._showPath = options.showPath;

      this._buildModule();
    },
    
    _buildModule : function() {
      var trElem = this._container.up('table.care-pathways-module-group-container').down('tr.care-pathways-section-label');
      var questionIdElement = trElem.down('input.cp-question-id');
      this._questionId = questionIdElement &amp;&amp; questionIdElement.value;

      this._navigationPanel = this._container.down('div.browse-categories-panel');

      this._collapseCategories();
      this._attachListeners();
    },

    _collapseCategories : function() {
      // Collapse any lists that do not have checked items.
      this._navigationPanel.select('span.expand-tool').each(function(item) {
        var listItemEl = item.up('li.term-entry');
        var innerList = listItemEl &amp;&amp; listItemEl.down('ul');
        if (innerList) {
          if (!innerList.down('input[type="checkbox"]:checked') &amp;&amp; !innerList.up().up().hasClassName('cp-module-test')) {
            innerList.hide();
          } else {
            item.removeClassName("fa-caret-right");
            item.addClassName("fa-caret-down");
            item.addClassName("expanded");
          }
        }
      });      
    },

    _attachListeners : function() {
      this._attachCheckedListeners();
      this._attachDeleteListeners();
    },

    _attachCheckedListeners : function() {
        var _this = this;
      this._navigationPanel.observe('click', function(event) {
        var labelEl = event.findElement('label');
        var actionEl = labelEl &amp;&amp; labelEl.down('span.expand-tool');
        // The only click event we care about is the one on the expand tool. Any others can be stopped.
        actionEl &amp;&amp; _this._toggleCollapsed(actionEl) || event.stopPropagation();
      });

      this._navigationPanel.observe('change', function(event) {
        var labelEl = event.findElement('label');
        var actionEl = labelEl &amp;&amp; labelEl.down('input.add-tool');
        event.stop();
        actionEl &amp;&amp; _this._toggleChecked(actionEl);
      });
    },

    _attachDeleteListeners : function() {
      var _this = this;
      this._container.observe('cp-selection:category:cleared', function(event) {
        var receivedMemo = event.memo;
        if (receivedMemo) {
          var module = receivedMemo.module;
          var questionId = receivedMemo.questionId;
          var deletedTerm = receivedMemo.id;
          var variantNum = receivedMemo.variantNum || null;
          var variantStub = variantNum ? '-' + variantNum : '';
          var checkbox = $('cp-add-tool-' + module + '-' + questionId + '-' + deletedTerm + variantStub);
          checkbox &amp;&amp; checkbox.checked &amp;&amp; (checkbox.checked = false);
        }
      });
    },

    _toggleCollapsed : function(elem) {
      var parentList = elem.up('li.term-entry');
      var collapseList = parentList &amp;&amp; parentList.down('ul');
      if (elem.hasClassName("expanded")) {
        elem.removeClassName("fa-caret-down");
        elem.addClassName("fa-caret-right");
        elem.removeClassName("expanded");
        collapseList &amp;&amp; collapseList.hide();
      } else {
        elem.removeClassName("fa-caret-right");
        elem.addClassName("fa-caret-down");
        elem.addClassName("expanded");
        collapseList &amp;&amp; collapseList.show();
      }
      return true;
    },

    _toggleChecked : function(elem) {
      var termNameEl = elem.next('span.term-name');
      var termName = termNameEl ? termNameEl.innerHTML : "";
      if (termName) {
        var parentLi = elem.up('li.term-entry');
        var submoduleEl = parentLi.down('input.submodule-name');
        var prefix = this._showPath ? this._getLabelPrefix(parentLi) : "";
        var memo = {"term_id" : elem.name, "term_name" : prefix + termName, "submodule" : submoduleEl ? submoduleEl.value : ""};
        if (parentLi.hasClassName('custom')) {
          var parentIdElem = parentLi.down('input.parent-id');
          var parentId = parentIdElem &amp;&amp; parentIdElem.value;
          parentId &amp;&amp; (memo["term_id"] = parentId + "_other");
          memo["notmapped"] = true;
        }
        var event = (elem.checked 
          &amp;&amp; Event.fire(this._container, "cp-navigation:category:checked", memo))
          || this._uncheckAfterSuccessfulDelete(elem, "cp-navigation:category:unchecked", memo);
      }
    },

    _getLabelPrefix : function(listElem) {
      var parentListElem = listElem.up('li.term-entry');
      if (parentListElem) {
        var nameElem = parentListElem.down('span.term-name');
        var name = nameElem &amp;&amp; nameElem.innerHTML || "";
        var prefix = this._getLabelPrefix(parentListElem);
        return prefix + name + " » ";
      } else {
        return "";
      }
    },

    _uncheckAfterSuccessfulDelete : function(elem, eventName, memo) {
      elem.checked = true;
      Event.fire(this._container, eventName, memo);
    }
  });

  // End PhenoTips augmentation.
  return PhenoTips;
}(PhenoTips || {}));</code>
    </property>
    <property>
      <name>Care Pathways module navigation panel widget</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>3</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>ce0a1542-6ff2-481f-b0e6-6494513fbbbf</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>var PhenoTips = (function(PhenoTips) {
  var widgets = PhenoTips.widgets = PhenoTips.widgets || {};
  // Care Pathways.
  var cp = widgets.carePathways = widgets.carePathways || {};

  cp.ModuleSelectionPanel = Class.create({
    initialize : function(container, options) {
      if (!container) { return; }
      this._container = container;

      this._getChildrenUrl = options.localUrl;
      this._addInputsFx = options.addInputsFx;
      this._addTextboxesFx = options.addTextboxesFx;
      this._termCount = 0;
      this._qualifierCount = 0;
      this._getCount = options.getCount || function() { return this._qualifierCount; };
      this._updateCount = options.updateCount || function(count) { this._qualifierCount = count; };
      this._deleteQualifierAction = options.deleteQualifier;
      this._clearCategoryAction = options.clearCategory;

      this._qualifierDataMarker = options.qualifierDataMarker;

      this._selectedSummary = options.currentSelectionPanel;
      this._moduleType = options.moduleType;

      this._selectedSummary &amp;&amp; this._buildModule();
    },

    _buildModule : function() {
      this._termsTable = this._selectedSummary.down('table.terms-data-table');

      var variantTypeElem = this._selectedSummary.down('input.associated-variant-type');
      this._variantType = variantTypeElem &amp;&amp; variantTypeElem.value;

      var variantNumber = this._selectedSummary.down('input.associated-variant-number');
      this._variantNumber = variantNumber &amp;&amp; variantNumber.value || null;

      var trQuestionElem = this._container.up('table.care-pathways-module-group-container').down('tr.care-pathways-section-label');
      var questionIdElement = trQuestionElem.down('input.cp-question-id');
      this._questionId = questionIdElement &amp;&amp; questionIdElement.value;

      var subjectElement = this._selectedSummary.down('input.cp-current-selection-subject');
      this._subject = subjectElement &amp;&amp; subjectElement.value;

      this._retrieveStoredData();
      this._attachListeners();
    },

    _retrieveStoredData : function() {
      var datesElem = this._selectedSummary.down('input.cp-current-selection-dates');
      if (datesElem) {
        var datesStr = datesElem.value;
        this._dates = datesStr &amp;&amp; JSON.parse(datesStr);
        datesElem.remove();
      }

      var storedDataElem = this._selectedSummary.down('input.cp-current-selection-stored-data');
      var storedData;
      if (storedDataElem) {
        storedData = storedDataElem.value;
        storedDataElem.remove();
      }
      var json = storedData &amp;&amp; JSON.parse(storedData);
      if (json) {
        var _this = this;
        var promises = [];
        $H(json).each(function(pair) {
          var data = pair.value;
          if (data.id &amp;&amp; data.label) {
            var matchingCheck = "cp-add-tool-" + _this._moduleType + "-" + _this._questionId + "-" + data.id + ((_this._variantNumber == 0 || _this._variantNumber) ? "-" + _this._variantNumber : "");
            var matchingCheckEl = $(matchingCheck);
            var submoduleEl = matchingCheckEl &amp;&amp; matchingCheckEl.next("input.submodule-name");
            var submodule = submoduleEl &amp;&amp; submoduleEl.value || "";
            var request = _this._buildNewTermElement.bind(_this, submodule, data.id, data.label, data)();
            promises.push(request);
          }
        });
        // Do one by one.
        jQuery.when.apply(null, promises).done(function() {
          Event.fire(document, "cp-selection:data:loaded");
          // Importing already saved data.
          Event.fire(document, "xwiki:document:saved");
        });
      }
    },

    _attachListeners : function() {
      var _this = this;
      this._container.observe("cp-navigation:category:checked", function(event) {
        var termId, termName;
        if (event.memo) {
          termId = event.memo.term_id;
          termName = event.memo.term_name || termId;
          submodule = event.memo.submodule;
          termId &amp;&amp; termName &amp;&amp; _this._buildNewTermElement.bind(_this, submodule, termId, termName || termId, undefined)();
        }
      });

      this._container.observe("cp-navigation:category:unchecked", function(event) {
        var termId, termName;
        if (event.memo) {
          termId = event.memo.term_id;
          var deleteAction = termId &amp;&amp; $('delete_term_' + termId) || null;
          deleteAction &amp;&amp; deleteAction.click();
        }
      });
    },

    _observeQualifierEvents : function(qualifiers) {
      var parent = qualifiers.up('tr.' + this._moduleType + '_field') || qualifiers.up('tr.' + this._moduleType + '_field');
      var _this = this;
      qualifiers.observe('parent:term:deleted', function(event) {
        var memo = {"id" : event.memo.id, "module" : _this._moduleType, "variantNum" : _this._variantNumber, "questionId" : _this._questionId};
        Event.fire(_this._container, 'cp-selection:category:cleared', memo);
        parent &amp;&amp; parent.remove();
      })
    },

    _buildNewTermElement : function(submodule, termId, termName, values) {
      var termDeleteStr = this._clearCategoryAction
        .replace(/([&amp;?]category=)(xXx__CATEGORY_TEMPLATE__xXx)([&amp;$])/, "$1" + termId + "$3")
        .replace(/([&amp;?]question=)(xXx__QUESTION_TEMPLATE__xXx)([&amp;$])/, "$1" + this._questionId + "$3");
      var options = {'allowMultiDialogs': true, 'disableTermDelete': false, 'termDeleteAction' : termDeleteStr};
      return this._doDoneDataResponse(this._constructDataRequest(termId), submodule, termId, termName, options, values);
    },

    _constructDataRequest : function(termId) {
      var url = this._getChildrenUrl + "input=" + encodeURIComponent(termId);
      var parameters = {};
      parameters.customFilter = "is_a:" + termId.replace(/:/g, "\\:");
      var _this = this;

      return jQuery.ajax(url, {
        method: "GET",
        data: parameters
      });
    },

    _doDoneDataResponse : function(req, submodule, termId, termName, options, values) {
      return req
        .done(this._buildNewTermElementFromResponse.bind(this, submodule, termId, termName, options, values))
        .fail(function(jqXHR, textStatus, errorThrown) {
        // TODO: Construct dialog with no typeahead options on failure??
        });
    },

    _buildNewTermElementFromResponse : function(submodule, termId, termName, options, values, response) {
      var json = response &amp;&amp; response.rows;
      if (json) {
        var tableCol = new Element('td');
        var tableRow = new Element('tr', {'class': this._moduleType + '_field category-data'} )
        var qualifiersWidget = this._buildDetailsDialog(submodule, termId, termName, options, json);
        var qualifiers = qualifiersWidget.get();
        // Set values silently, or initialize as affected, non-silently. If values are provided, then we're displaying
        // stored tests. If no values are provided, then we're adding a new test/care item with a qualifier dialog.
        qualifiers._widget = qualifiersWidget;
        tableRow.insert(tableCol.insert(qualifiers));
        this._observeQualifierEvents(qualifiers);
        this._termsTable.insert(tableRow);
        if (values) {
          qualifiersWidget.setValues(values);
        } else {
          qualifiersWidget.initAffected(false);
        }
      }
    },

    _buildDetailsDialog : function(submodule, termId, termName, options, json) {
      var qualifiersWidget = new PhenoTips.widgets.carePathways.CPDetailsDialogGroup("parent", options)
        .withGlobalQualifierCount(this._getCount, this._updateCount)
        .withQualifierDataMarker(this._qualifierDataMarker + "_")
        .withLabel(termName, termId, null, true)
        .dialogsAddDeleteAction(this._deleteQualifierAction);
      this._pickSubjectElement(qualifiersWidget);
      this._addDateElements(qualifiersWidget);
      this._addPursued(qualifiersWidget);
      this._addInputsFx &amp;&amp; this._addInputsFx(qualifiersWidget, json, termId, this._moduleType, submodule, this._qualifierDataMarker);
      this._addTextboxesFx &amp;&amp; this._addTextboxesFx(qualifiersWidget, this._questionId, parseInt(this._variantNumber), termId, this._moduleType, submodule);
      return this._addHiddenDataElements(qualifiersWidget);
    },

    _pickSubjectElement : function(qualifiersWidget) {
      if (this._moduleType === 'family') {
        qualifiersWidget.dialogsAddItemSelect({
          'data': ['', 'mother', 'father', 'sister', 'brother', 'aunt', 'uncle'],
          'defListItemClass': 'subject mandatory',
          'inputSourceClass': this._moduleType + '_subject',
          'qualifierLabel': "$escapetool.javascript($services.localization.render('phenotips.carePathways.detailsDialog.subject.title'))",
          'qualifierName': 'subject'
        });
      } else {
        qualifiersWidget.dialogsAddHiddenDataElement({
          'defListItemClass': 'subject hidden',
          'inputSourceClass': this._moduleType + '_subject',
          'qualifierName': 'subject',
          'hiddenDataValue': this._subject
        });
      }
      return qualifiersWidget;
    },

    _addDateElements : function(qualifiersWidget) {
      // All Care Pathways dates are mandatory.
      this._dates &amp;&amp; this._dates.each(function(date) {
        var name = date.name;
        var label = date.label;
        name &amp;&amp; qualifiersWidget.dialogsAddDatePicker(false, {
          'trackLastEnteredDate' : true,
          'defListItemClass': name + ' date-element mandatory-date',
          'qualifierLabel': label,
          'qualifierName': name + '_fuzzy',
          'approxQualifierName' : name});
      });
    },

    _addPursued : function(qualifiersWidget) {
      var pursued = this._selectedSummary.down('input.cp-current-selection-pursued');
      pursued = pursued &amp;&amp; pursued.value === 'true';
      if (!pursued) {
        return;
      }
      qualifiersWidget.dialogsAddRadioList(false, {'qualifierLabel': 'Pursued within 1 year?', 'qualifierName': 'pursued', 'inline':'inline', 'data':['Unknown', 'Yes', 'No'], 'storedToDisplayedMapper': function(v) {
      return (v === "0" ? 'No' : v === "1" ? 'Yes' : 'Unknown')}, 'displayedToStoredMapper': function(v) {
      return (v === 'No' ? "0" : v === 'Yes' ? "1" : -1)}});
    },

    _addHiddenDataElements : function(qualifiersWidget) {
      this._variantType &amp;&amp; qualifiersWidget.dialogsAddHiddenDataElement({
        'defListItemClass': 'type hidden',
        'inputSourceClass': this._moduleType + '_type',
        'qualifierName': 'type',
        'hiddenDataValue': this._variantType
      });

      this._variantNumber &amp;&amp; qualifiersWidget.dialogsAddHiddenDataElement({
        'defListItemClass': 'variant hidden',
        'inputSourceClass': this._moduleType + '_variant',
        'qualifierName': 'variant',
        'hiddenDataValue': parseInt(this._variantNumber)
      });

      qualifiersWidget.dialogsAddHiddenDataElement({
          'defListItemClass': 'question hidden',
          'inputSourceClass': this._moduleType + '_question',
          'qualifierName': 'question',
          'hiddenDataValue': this._questionId})
        .dialogsAddHiddenDataElement({
          'defListItemClass': 'date_entered hidden',
          'inputSourceClass': this._moduleType + '_date_entered',
          'qualifierName': 'date_entered',
          'hiddenDataValue': ''})
        .dialogsAddHiddenDataElement({
          'defListItemClass': 'date_amended hidden',
          'inputSourceClass': this._moduleType + '_date_amended',
          'qualifierName': 'date_amended',
          'hiddenDataValue': ''})
        .dialogsAddHiddenDataElement({
          'defListItemClass': 'module hidden',
          'inputSourceClass': this._moduleType + '_module',
          'qualifierName': 'module',
          'hiddenDataValue': this._moduleType});

        var widgetElem = qualifiersWidget.get();
        widgetElem.observe("parent:dialog:added", this._onDialogAddedListener.bind(this));
        widgetElem.observe("detailsDialogGroup:dialogs:added", this._onDialogAddedListener.bind(this));

        return qualifiersWidget;
    },

    _onDialogAddedListener : function(event) {
      if (!event.memo) { return; }
      var _this = this;
      var elements = [];
      if (event.memo.elements) {
        elements = event.memo.elements;
        elements.each(_this._attachDialogChangedListener.bind(_this));
      } else if (event.memo.element) {
        elements.push(event.memo.element);
        this._attachDialogChangedListener(event.memo.element);
      }
      elements.size() &amp;&amp; Event.fire(document, "xwiki:dom:updated", {"elements" : elements});
    },

    _attachDialogChangedListener : function(dialog) {
      var dateAmendedInput = dialog.down('input.' + this._moduleType + '_date_amended');
      dateAmendedInput &amp;&amp; dialog.observe('change', function(event) {
        dateAmendedInput.value = "";
      });
    },

    _getToStoredTypeAheadFx : function(json) {
      var mapped = new Map(json.map(function(x) { return [x.name, x.id]; }));
      return function(item) {
        return mapped.get(item) || item;
      };
    },

    _getToDisplayedTypeAheadFx : function(json) {
      var mapped = new Map(json.map(function(x) { return [x.id, x.name]; }));
      return function(item) {
        return mapped.get(item) || item;
      };
    }
  });

  // End PhenoTips augmentation.
  return PhenoTips;
}(PhenoTips || {}));</code>
    </property>
    <property>
      <name>Care Pathways current module selection widget</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>4</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>0afd552f-ff87-4908-a916-6ecb387e20a6</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>// Initialization of multi-picker, selection, and navigation panels.
// This also contains some custom Care Pathways code.
var qualifierCount = 0;
var getCount = function() {
  return qualifierCount;
};

var incrementCount = function() {
  qualifierCount++;
};

var updateCount = function(count) {
  qualifierCount = count;
};

var getToStoredTypeAheadFx = function(json) {
  var mapped = new Map(json.map(function(x) { return [x.name, x.id]; }));
  return function(item) {
    return mapped.get(item) || item;
  };
};

var getToDisplayedTypeAheadFx = function(json) {
  var mapped = new Map(json.map(function(x) { return [x.id, x.name]; }));
  return function(item) {
    return mapped.get(item) || item;
  };
};

var addInputFormElements = function(qualifiersWidget, json, termId, moduleType, submoduleType, dataStorage) {
  // TODO: This will be different for a gene panel/single gene.
  var detailsRemoteUrl = new XWiki.Document('CarePathwaysDataSearch', 'PhenoTips').getURL('get', 'dataclass=' + dataStorage);
  var labRemoteUrl = new XWiki.Document('CarePathwaysLaboratorySearch', 'PhenoTips').getURL('get', 'dataclass=' + dataStorage);
  var locationRemoteUrl = new XWiki.Document('CarePathwaysLocationSearch', 'PhenoTips').getURL('get', 'dataclass=' + dataStorage);

  (submoduleType == "genetic" || submoduleType == "done") &amp;&amp; qualifiersWidget.dialogsAddTypeAhead(false, {
    'remote' : labRemoteUrl + "&amp;input=",
    'data': [],
    'placeholder': 'Begin typing or click to show options',
    'defListItemClass': moduleType + ' laboratory mandatory',
    'inputSourceClass': moduleType + '_typeahead',
    'qualifierLabel': "$escapetool.javascript($services.localization.render('phenotips.carePathways.detailsDialog.laboratory.title'))",
    'qualifierName': 'laboratory'});

  false &amp;&amp; moduleType == "care" &amp;&amp; this._questionId == "CPQ:6" &amp;&amp; qualifiersWidget.dialogsAddTypeAhead(false, {
    'remote' : locationRemoteUrl + "&amp;input=",
    'data': [],
    'placeholder': 'Begin typing or click to show options',
    'defListItemClass': moduleType + ' location mandatory',
    'inputSourceClass': moduleType + '_typeahead',
    'qualifierLabel': "$escapetool.javascript($services.localization.render('phenotips.carePathways.detailsDialog.location.title'))",
    'qualifierName': 'location'});

  qualifiersWidget.dialogsAddTypeAhead(false, {
    'remote' : detailsRemoteUrl + "&amp;parent=" + termId + "&amp;input=",
    'data': json.map(function(x) { return x.name; }),
    'placeholder': 'Begin typing or click to show options',
    'defListItemClass': moduleType + ' datum' + ((json.size() || termId.endsWith('_other') || termId === 'CP:1110' || termId === 'CP:1111') ? ' mandatory' : ''),
    'inputSourceClass': moduleType + '_typeahead',
    'qualifierLabel': "$escapetool.javascript($services.localization.render('phenotips.carePathways.detailsDialog.datum.title'))",
    'qualifierName': 'datum',
    'displayedToStoredMapper': getToStoredTypeAheadFx(json),
    'storedToDisplayedMapper': getToDisplayedTypeAheadFx(json)});
};

// Cannot use typeahead.bundle.min.js, need to define typeahead and bloodhound separately.
require.config({
  paths: {
    'typeahead': "$services.webjars.url('org.webjars.npm:corejs-typeahead', 'dist/typeahead.jquery.min.js')",
    'bloodhound': "$services.webjars.url('org.webjars.npm:corejs-typeahead', 'dist/bloodhound.min.js')"
  },
  shim: {
    'typeahead': {
      deps: ['jquery']
    },
    'bloodhound': {
      deps: ['jquery'],
      exports: 'Bloodhound'
    }
  }
});

var initNavAndSelMods = function(modules) {
    modules &amp;&amp; modules.length &gt; 0 &amp;&amp; modules.each(function(module) {
      var localUrl = XWiki.contextPath + "/rest/vocabularies/care-pathways/suggest?sort=nameSort%20asc&amp;maxResults=10000&amp;";
      var dataStorageEl = $("data-storage-class");
      var dataStorage = dataStorageEl &amp;&amp; dataStorageEl.value;
      var clearCategoryEl = $('clear-category-action');
      var deleteQualifierEl = $('delete-qualifier-action');
      var options = {"localUrl" : localUrl, "addInputsFx" : addInputFormElements, "getCount" : getCount, "incrementCount" : incrementCount, "updateCount" : updateCount, "clearCategory" : clearCategoryEl.value, "deleteQualifier" : deleteQualifierEl.value, "qualifierDataMarker" : dataStorage, "showPath" : true};
      options.currentSelectionPanel = module.down('div.current-selection-panel');
      var moduleTypeElem = options.currentSelectionPanel &amp;&amp; options.currentSelectionPanel.down('input[name=moduleType]');
      options.moduleType = moduleTypeElem &amp;&amp; moduleTypeElem.value;
      new PhenoTips.widgets.carePathways.ModuleSelectionPanel(module, options);
      new PhenoTips.widgets.carePathways.ModuleNavigationPanel(module, options);
    });
    return true;
};

var initFamilyMods = function(modules) {
  modules &amp;&amp; modules.length &gt; 0 &amp;&amp; modules.each(function(module) {
    var dataStorageEl = $("data-storage-class");
    var dataStorage = dataStorageEl &amp;&amp; dataStorageEl.value;
    var deleteQualifierEl = $('delete-qualifier-action');

    var tableEl = module.up('table.posttest-section.care-pathways-module-group-container');
    var questionEl = tableEl &amp;&amp; tableEl.down('input.cp-question-id');

    var moduleGroupEl = module.up('.care-pathways-modules-wrapper');
    var variantEl = moduleGroupEl &amp;&amp; moduleGroupEl.down('input.variant-number');

    var datumEl = module.down('input.test-id');

    var typeEl = module.down('input.associated-variant-type');

    var storedDataEl = module.down('input.cp-current-selection-stored-data');
    var dataElements = {"question" : questionEl &amp;&amp; questionEl.value, "variant" : variantEl &amp;&amp; variantEl.value, "datum" : datumEl &amp;&amp; datumEl.value, "type" : typeEl &amp;&amp; typeEl.value, "date_entered" : "", "date_amended" : ""};
    var options = {"getCount" : getCount, "incrementCount" : incrementCount, "updateCount" : updateCount, "deleteQualifier" : deleteQualifierEl.value, "qualifierDataMarker" : dataStorage, "dataName" : "subject", "dataElements" : dataElements, "storedDataEl" : storedDataEl};
    new PhenoTips.widgets.carePathways.MultiPicker(module, options);
  });
  return true;
};

var init = function(event) {
  require(["jquery", "bloodhound", "typeahead"], function(jquery, Bloodhound, typeahead) {
    if (event.memo &amp;&amp; event.memo.element) {
      var elem = event.memo.element;
      var standardModules = elem.select(".care-pathways-module-container");
      initNavAndSelMods(standardModules);
      var familyModules = elem.select(".care-pathways-family-module-container");
      initFamilyMods(familyModules);
    } else {
      initNavAndSelMods($$(".care-pathways-module-container"));
      initFamilyMods($$(".care-pathways-family-module-container"));
    }
    return true;
  });
};

(XWiki.domIsLoaded &amp;&amp; init()) || document.observe("xwiki:dom:loaded", function(event) {
  init(event);
  document.observe('cp:navmodules:added', init);
});</code>
    </property>
    <property>
      <name>Selection and navigation module initializer</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>5</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>34b8353b-483f-47a0-b61b-cb6935b684a2</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>var PhenoTips = (function(PhenoTips) {
  var widgets = PhenoTips.widgets = PhenoTips.widgets || {};
  // Care Pathways.
  var cp = widgets.carePathways = widgets.carePathways || {};

  cp.VariantAnalysisModule = Class.create({
    initialize : function(options) {
      this._questionsClearUrl = options.questionsClearUrl;

      this._buildModule();
      this._attachGeneAddedListener();
    },

    _buildModule : function() {
      $$('.no-variants-container').each(this._buildVariantsDataAnalysis.bind(this));
    },

    _buildVariantsDataAnalysis : function(container) {
      var clearDataInput = container.down('.clear-data-url');
      var clearDataUrl = clearDataInput &amp;&amp; clearDataInput.value || "";
      var variantsContainer = container.next('.variants-container');
      var noVariantsCheckbox = container.down('input[type="checkbox"]');

      if (!noVariantsCheckbox || !variantsContainer) {
        return;
      }

      noVariantsCheckbox.checked &amp;&amp; variantsContainer.hide();
      noVariantsCheckbox.observe('click', function(event) {
        event.stopPropagation();
      });

      var _this = this;
      noVariantsCheckbox.observe('change', function(event) {
        event.stop();
        if (noVariantsCheckbox.checked) {
          var genesTables = variantsContainer.select('table.gene-table.cp-variants.extradata-list');
          var tables = [];
          genesTables.each(function(genesTable) {
            var inputs = genesTable.select('input.gene-id');
            if (inputs &amp;&amp; inputs.size() &gt; 0) {
              genesTable.__inputs = inputs;
              tables.push(genesTable);
            }
          });
          if (tables.size() == 0) {
            // There is no variant data.
            variantsContainer.hide();
          } else {
            // There is variant data. Do a confirmed ajax request and check only on success.
            noVariantsCheckbox.checked = false;
            _this._ajaxClearGenes.bind(_this, clearDataUrl, noVariantsCheckbox, tables, variantsContainer, null)();
          }
        } else {
          variantsContainer.show();
        }
      });
    },

    _attachGeneAddedListener : function() {
      var _this = this;
      document.observe("xwiki:dom:updated", function(event) {
        var elem = event.memo &amp;&amp; event.memo.elements &amp;&amp; event.memo.elements[0];
        var statusCol = elem &amp;&amp; elem.down('td.Status.gene');
        if (statusCol) {
          // This is a gene.
          var savedStatus = statusCol.down('input.gene-status-value');
          var defaultStatus = statusCol.down('input.default-gene-status-value');
          // The extraGeneVariantData sets the value to "candidate" by default. That's not what we want.
          savedStatus &amp;&amp; defaultStatus &amp;&amp; (savedStatus.value = defaultStatus.value);
        }
      });
    },

    _ajaxClearGenes : function(url, checkbox, genesTables, variantsContainer, clearRelatedDataFx) {
      var _this = this;
      if (checkbox.disabled) { return; }
      if (confirm("$!escapetool.javascript($services.localization.render('phenotips.carePathways.postTest.cpNoVariantsConfirmation'))")) {
        var req = jQuery.ajax(url, {
          method: "GET",
          beforeSend: function () { checkbox.disabled = true; }
        })
        .always(function () { checkbox.disabled = false; })
        .done(function (data, textStatus, jqXHR) {
          checkbox.checked = true;
          genesTables.each(function(genesTable) {
            _this._clearDisplayedGeneData.bind(_this, genesTable, genesTable.__inputs)();
          });
          variantsContainer.hide();
          clearRelatedDataFx &amp;&amp; clearRelatedDataFx();
        });
      }
    },

    _clearDisplayedGeneData : function(genesTable, geneIdInputs) {
      geneIdInputs.each(function(geneIdInput) {
        var geneId = geneIdInput.value;
        var className = geneIdInput.up('td').className;
        var geneIndex = parseInt(className.substring(className.lastIndexOf('-') + 1), 10);
        var dataRow = geneIdInput.up('tr');
        geneIdInput.remove();
        var geneNameInput = dataRow.down('input.gene-name');
        geneNameInput.__validation.destroy();
        $$('.variant-gene-' + geneIndex).each(function(item) {
          item.select('td.mandatory :input:not([type="hidden"])', '.mandatory-date input.fuzzy-date').each(function(validatedElem) {
            validatedElem.__validation &amp;&amp; validatedElem.__validation.destroy();
          });
          item.remove();
        });
        dataRow.remove()

        var i = 1;
        genesTable.select('td.row-count').each(function(item) {
          var geneRowIndex = item.next().className.substring(item.next().className.lastIndexOf('-') + 1);
          var y = 1;
          $$('.variant-hide-heading-' + geneRowIndex + ' .variant-row-count').each(function(vitem) {
            vitem.childNodes[1].textContent = i + '.' + (y++);
          });
          item.update(i++);
        });
      });
    }
  });

  var init = function() {
    var options = {};
    var questionsClearUrlEl = $('clear-questions-data');
    options.questionsClearUrl = questionsClearUrlEl &amp;&amp; questionsClearUrlEl.value;
    new PhenoTips.widgets.carePathways.VariantAnalysisModule(options);
  };

  (XWiki.domIsLoaded &amp;&amp; init()) || document.observe('xwiki:dom:loaded', init);

  // End PhenoTips augmentation.
  return PhenoTips;
}(PhenoTips || {}));</code>
    </property>
    <property>
      <name>Care Pathways variant analysis module widget</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>6</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>bb5650f9-cfc6-4c61-910b-af451bb0616a</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>var PhenoTips = (function(PhenoTips) {
  var widgets = PhenoTips.widgets = PhenoTips.widgets || {};
  //Care Pathways.
  var cp = widgets.carePathways = widgets.carePathways || {};

  cp.MultiPicker = Class.create({
    initialize : function(container, options) {
      this._container = container;
      this._qualifierCount = 0;
      this._getCount = options.getCount || function() { return this._qualifierCount; };
      this._updateCount = options.updateCount || function(count) { this._qualifierCount = count; };
      this._incrementCount = options.incrementCount || function() { this._qualifierCount++; };
      this._deleteQualifierAction = options.deleteQualifier;
      this._qualifierDataMarker = options.qualifierDataMarker;
      this._dataElements = options.dataElements || {};
      this._dataName = options.dataName;

      this._setStoredValues(options.storedDataEl);
      this._attachClickListeners();
    },

    _setStoredValues : function(storedDataEl) {
      if (storedDataEl) {
        var storedStr = storedDataEl.value;
        storedDataEl.remove();
        var storedJson = JSON.parse(storedStr || "[]");
        var _this = this;
        storedJson.each(function(elem) {
          var term = elem[_this._dataName];
          var target = _this._container.down('span.term-picker.' + term);
          target &amp;&amp; _this._insertDataElements.bind(_this, term, elem.count, target, target.down('input[type="checkbox"]'), elem)();
        });
        // Importing already saved data.
        Event.fire(document, "xwiki:document:saved");
      }
    },

    _attachClickListeners : function() {
      var _this = this;
      this._container.observe('click', function(event) {
        if (event.target.type !== "checkbox") {
          event.stop();
        }
        var target = event.findElement('span.term-picker');
        if (target) {
          _this._toggleSelected.bind(_this, target)();
        }
      });
    },
    
    _toggleSelected : function(target) {
      var checkbox = target.down('input[type="checkbox"]');
      if (target.hasClassName('selected')) {
        this._deleteElData(target, checkbox);
      } else {
        var pickedEl = target.down('input.selected-item-id');
        this._insertDataElements(pickedEl.value, this._getCount(), target, checkbox, {});
      }
    },

    _insertDataElements : function(pickedElVal, count, target, checkbox, storedData) {
      var _this = this;
      if (target.disabled) { return; }
      $H(this._dataElements).each(function(pair) {
        var propName = pair.key;
        var propValue = storedData[propName] || pair.value;
        if (propValue !== undefined &amp;&amp; propValue !== null) {
          var dataEl = new Element('input', {'type' : 'hidden', 'class' : propName + '-stored-value', 'name' : _this._qualifierDataMarker + '_' + count + '_' + propName, 'value' : propValue});
          target.insert(dataEl);
        }
      });
      target.addClassName('selected');
      checkbox &amp;&amp; (checkbox.checked = true);
      var pickedDataEl = new Element('input', {'type' : 'hidden', 'class' : this._dataName + '-stored-value', 'name' : this._qualifierDataMarker + '_' + count + '_' + this._dataName, 'value' : pickedElVal});
      var countEl = new Element('input', {'type' : 'hidden', 'class' : this._dataName + '-count', 'value' : count});
      target.insert(pickedDataEl).insert(countEl);
      count &gt;= _this._getCount() &amp;&amp; _this._updateCount(++count);
    },

    _deleteElData : function(target, checkbox) {
      var elCount = target.down('input.' + this._dataName + '-count');
      if (!target.disabled &amp;&amp; elCount &amp;&amp; this._deleteQualifierAction) {
        var url = this._deleteQualifierAction.replace(/([&amp;?]classid=)(xXx__COUNT_TEMPLATE__xXx)([&amp;$])/, "$1" + elCount.value + "$3");
        jQuery.ajax(url, {
          method: "GET", 
          beforeSend: function () {
            target.disabled = true;
            target.down('label').hide();
            target.insert(new Element('span', {'class' : "fa fa-lg fa-spinner fa-spin fa-fw"}));
          }
        })
        .always(function () {
          target.down('.fa-spinner').remove();
          target.down('label').show();
          target.disabled = false;
        })
        .done(function (data, textStatus, jqXHR) {
          target.select('input[type="hidden"]:not(".selected-item-id")').each(function(hiddenEl) {
            hiddenEl.remove();
          });
          target.removeClassName('selected');
          checkbox &amp;&amp; (checkbox.checked = false);
        });
      }
    }
  });

  // End PhenoTips augmentation.
  return PhenoTips;
}(PhenoTips || {}));</code>
    </property>
    <property>
      <name>Care Pathways picker widget</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>7</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>883b6583-8c2a-4cab-a751-175db7cd1f3f</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>document.on("xwiki:dom:loaded", function(event) {
  var updateSaveAndViewAction = function() {
    var redirects = $$('input[name="xredirect"]');
    var redirect = redirects &amp;&amp; redirects.length &gt; 0 &amp;&amp; redirects[0];
    var cpredirects = $$('input[name="cpredirect"]');
    var cpredirect = cpredirects &amp;&amp; cpredirects.length &gt; 0 &amp;&amp; cpredirects[0];
    if (cpredirect &amp;&amp; redirect) {
      redirect.value = cpredirect.value;
    }
  };

  var updatePatientRecordActions = function() {
    var recordActions = $('patient-record-actions');
    var documentAuthors = $('document-authors');
    if (documentAuthors) {
      documentAuthors.show();
    }
    if (recordActions) {
      var listElem = recordActions.down('ul');
      var listItems = listElem &amp;&amp; listElem.childElements();
      listItems &amp;&amp; listItems.each(function(listElem) {
        var editAction = listElem.down('#prActionEdit');
        if (!editAction &amp;&amp; !listElem.down('input[name="action_saveandcontinue"]')) {
          listElem.hide();
        } else {
          var cpActionEditItems = $$('input[name="cpActionEdit"]');
          var cpActionEdit = cpActionEditItems &amp;&amp; cpActionEditItems.length &amp;&amp; cpActionEditItems[0];
          if (editAction &amp;&amp; cpActionEdit) {
            editAction.href = cpActionEdit.value;
          }
        }
      });
      recordActions.show();
    }
  };

  var hideSectionEditButtons = function() {
    var currentContainer = $('care-pathways-posttest-container') || $('care-pathways-pretest-container');
    currentContainer &amp;&amp; currentContainer.select('h2 a.action-edit').each(function(editIcon) {
      editIcon.hide();
    });
  };

  updateSaveAndViewAction();
  updatePatientRecordActions();
  hideSectionEditButtons();
});</code>
    </property>
    <property>
      <name>Edit save actions</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>8</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>bb2cf944-dfc9-454d-ade6-b6652fceab8a</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>var PhenoTips = (function(PhenoTips) {
  // Start XWiki augmentation
  var widgets = PhenoTips.widgets = PhenoTips.widgets || {};
  // Care Pathways.
  var cp = widgets.carePathways = widgets.carePathways || {};
  
  cp.RemoteDuplicatesValidator = Class.create({
    // Constants.
    NEW                  : "NEW",
    CHECKING             : "CHECKING",
    DONE                 : "DONE", 
    UNIQUE_CLASS         : "LV_CPMatchingVariants_unique",
    DUPLICATE_CLASS      : "LV_CPMatchingVariants_duplicate",

    initialize : function(input, selector, message, options) {
      this.options = options || {};
      this.serviceUrl = options.serviceUrl;
      if (!this.serviceUrl) { return; }
      
      this.input = input;
      this.novel = true;
      this.state = this.NEW;
      this.value = input.value;
      this.selector = selector;
      this.message = message;            
      this.hiddenElems = [];
      
      if (!this.input.__validation &amp;&amp; this.input.type !== "hidden") {
        try {
          this.input.__validation = new LiveValidation(this.input, {validMessage: '', wait : 500});
        }
        catch(err) {
          //console.log(err);
        }
      }

      this.input.__validation &amp;&amp; this.input.__validation.add(this.validate.bind(this));
    },

    check : function() {
      if (this.input.value !== this.value) {
        this.value = this.input.value;
        this.state = this.CHECKING;
        var _this = this;
        jQuery.ajax(this.serviceUrl + this.value, {
          method: "POST",
        }).done(function(data, textStatus, jqXHR) {
          _this._toggleDuplicate.bind(_this, data)();
        }).always(function() {
          _this.responded.bind(_this)();
          var currentMsgEl = _this.input.next('span');
          var currentMsg = currentMsgEl &amp;&amp; currentMsgEl.innerHTML || "";
          if (currentMsg !== "" &amp;&amp; currentMsg !== _this.message) {
            // If some other validation failed, and that failure message is displayed, it will be misleading to show 
            // actions associated with this validation.
            _this.hiddenElems &amp;&amp; _this._showDataElements(_this.hiddenElems);
            _this.options.addOnWarnButtons &amp;&amp; _this._removeActionButtons(_this.options.addOnWarnButtons);
          }
        });
      }    
    },

    _hideDataElements : function(elements) {
      elements.each(function(hiddenElem) {
        hiddenElem.addClassName('hidden');
      });
    },

    _showDataElements : function(elements) {
      elements.each(function(hiddenElem) {
        hiddenElem.removeClassName('hidden');
      });
    },

    _addActionButtons : function(buttons, data) {      
      this.options.addOnWarnButtonsContainer &amp;&amp; this.options.addOnWarnButtonsContainer.insert(buttons) || this.input.insert({'after' : buttons});
      buttons.observe('click', function(event) {
        var button = event.findElement('.button');
        button &amp;&amp; button.clickAction &amp;&amp; button.clickAction(data);
      });
    },

    _removeActionButtons: function(buttons) {
      buttons.up() &amp;&amp; buttons.remove();
    },

    _toggleDuplicate : function(matchingData) {            
      if (Object.keys(matchingData).length) {
        this._markDuplicate(matchingData);
      } else {
        this._markUnique();
      }
    },

    _markDuplicate : function(matchingData) {
      this.hiddenElems = this.options.hideOnWarnFx &amp;&amp; this.options.hideOnWarnFx() || [];
      this.input.removeClassName(this.UNIQUE_CLASS);
      this.input.addClassName(this.DUPLICATE_CLASS);
      this.isDuplicate();
      this.hiddenElems &amp;&amp; this._hideDataElements(this.hiddenElems);      
      this.options.addOnWarnButtons &amp;&amp; this._addActionButtons(this.options.addOnWarnButtons, matchingData);
    },

    _markUnique : function() {
      this.input.removeClassName(this.DUPLICATE_CLASS);
      this.input.addClassName(this.UNIQUE_CLASS);
      this.isUnique();
      this.hiddenElems &amp;&amp; this._showDataElements(this.hiddenElems);
      this.options.addOnWarnButtons &amp;&amp; this._removeActionButtons(this.options.addOnWarnButtons);
    },

    isUnique : function() {
      this.novel = true;
    },

    isDuplicate : function() {
      this.novel = false;
    },

    responded : function() {
      this.state = this.DONE;
      this.input.__validation.validate();
    },

    validate : function(value) {
      if (value.blank()) {
        return true;
      }
      if (this.state === this.DONE &amp;&amp;
          this.value === value &amp;&amp;         
          !this.novel) {        
        Validate.fail(this.message);        
      }
      this.check();
      return true;
    }
  });

  // End PhenoTips augmentation
  return PhenoTips;
}(PhenoTips || {}));</code>
    </property>
    <property>
      <name>Ajax duplicates validator</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>9</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>a3e85fbe-d1d9-4acd-8f7a-cdc2aeb3a2ba</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>var XWiki = (function(XWiki) {
  var addInputValidator = function(element) {
    if (!element.__validation) {
      element.__validation = new LiveValidation(element, {validMessage: '', wait : 500});
    }
    element.__validation.add(Validate.Presence, {failureMessage: "$escapetool.javascript($services.localization.render('phenotips.PatientSheetCode.failureEnterValue'))"});
  };

  var addFuzzyDateValidator = function(element) {
    if (!element.__validation) {
      element.__validation = new LiveValidation(element, {validMessage: '', wait : 500});
    }
    element.__validation.add(Validate.Presence, {failureMessage: "$escapetool.javascript($services.localization.render('phenotips.PatientSheetCode.failureSelectValue'))"});

    var fuzzyDiv = element.previous('div.fuzzy-date-picker');
    element.value = element.value === "{}" ? "" : element.value;
    if (fuzzyDiv) {
      if (element.up('.mandatory-date-full')) {
        element.__validation.add(Validate.Custom, {failureMessage: "$escapetool.javascript($services.localization.render('phenotips.PatientSheetCode.failureSelectValue'))", against: function() {
          return element.up('.mandatory-date-full').select('select').pluck('value').reject(Prototype.K).size() == 0;
        }});
      }
      fuzzyDiv.toggleClassName("invalid", !element.__validation.validate());
      element.observe("xwiki:date:changed", function(event) {
        fuzzyDiv.toggleClassName("invalid", !element.__validation.validate());
      });
    }
  };

  var init = function(event) {
    ((event &amp;&amp; event.memo.elements) || [$('body')]).each(function(item) {
      if (item.hasClassName("summary-item")) {
        item.__validated_Elems = [];
        item.select(".mandatory input.tt-input").each(function(element) {
          addInputValidator(element);
          item.__validated_Elems.push(element);
        });
        // A bit of a hack. If this is not done, scrollValidation will encounter an exception (typeahead has multiple inputs).
        item.select(".mandatory input.tt-hint").each(function(element) {
          if (!element.__validation) {
            element.__validation = new LiveValidation(element, {validMessage: '', wait : 500});
          }
        });
        item.select(".mandatory-date input.fuzzy-date").each(function(element) {
          addFuzzyDateValidator(element);
          item.__validated_Elems.push(element);
        });
        item.select(".mandatory select").each(function(element) {
          if (!element.__validation) {
            element.__validation = new LiveValidation(element, {validMessage: '', wait : 500});
          }
          element.__validation.add(Validate.Presence, {failureMessage: "$escapetool.javascript($services.localization.render('phenotips.PatientSheetCode.failureSelectValue'))"});
        });
        item.__validate();
      } else {
        item.select(".mandatory input[type='text']").each(function(element) {
          addInputValidator(element);
        });
        item.select(".mandatory-date input.fuzzy-date").each(function(element) {
          addFuzzyDateValidator(element);
        });
      }
    });
    return true;
  };

  (XWiki.domIsLoaded &amp;&amp; init()) || document.observe("xwiki:dom:loaded", init);
  document.observe("xwiki:dom:updated", init);

  // End XWiki augmentation.
  return XWiki;
}(XWiki || {}));</code>
    </property>
    <property>
      <name>Initialize validators</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>10</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>8e832f1d-ef9c-489e-a3ec-14c72c2ff185</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>(function() {
  var cancelSaveIfNotValid = function(event) {
    if (event &amp;&amp; event.memo &amp;&amp; !event.memo.continue) {
      if (!this.__validation.validate()) {
        event.memo.originalEvent.stopped = true;
      }
    }
  };
  var _generateMessage = function (min, max) {
     if (!min &amp;&amp; !max) return '';
     var lastValue = 0;
     var message = 'Please select ';
     if (min == max) {
        lastValue = max;
        message += "exactly " + max; 
     } else {
       if (min) {
          lastValue = min;
          message += "at least " + min;
       }
       if (min &amp;&amp; max) {
         message += " and "
       }
       if (max) {
         lastValue = max;
         message += "at most " + max;
       }
     }
     message += " option" + (lastValue == 1 ? '' : 's') + ': ';
     var validCheckbox = new Element('input', {type : 'checkbox', 'class': 'required'});
     validCheckbox.__validation = new LiveValidation(validCheckbox, {validMessage: '', wait : 500});
     validCheckbox.__validation.add(Validate.Acceptance, {failureMessage: ''});
     document.observe('xwiki:actions:save', cancelSaveIfNotValid.bindAsEventListener(validCheckbox));
     return new Element('p', {'class' : 'mandatory selection-restriction-msg'}).update(message).insert(validCheckbox).insert(new Element('span', {'class' : 'fa fa-exclamation-triangle'})).insert(new Element('span', {'class' : 'fa fa-check'}));
  }

  var _selectionSync = function(min, max, options, msg) {
     var selected = options.filter(o =&gt; o.checked == true).size();
     if (options[0].type == 'checkbox') {
       options.filter(o =&gt; o.checked == false).invoke((selected == max) ? 'disable' : 'enable');
     }
     var satisfied = (!min || selected &gt;= min) &amp;&amp; (!max || selected &lt;=max);
     msg.toggleClassName('satisfied', satisfied);
     msg.down('input').checked = satisfied;
  }

  var onTermDeleted = function(event) {
    var element = event &amp;&amp; event.memo &amp;&amp; event.memo.id &amp;&amp; $$('input[class="term-id"][value="' + event.element().id.replace(/.*_/, '') + '"]')[0];
    element = element &amp;&amp; element.up('.care-pathways-modules');
    element = element &amp;&amp; element.__validationCallback;
    element &amp;&amp; element();
  };

  var init = function(event) {
    $$('.care-pathways-modules:not(initialized)').each(function(module) {
      var min = module.dataset.selectionMin;
      var max = module.dataset.selectionMax;
      if (min || max) {
        var optionsPanel = module.select(".cp-categories-panel.browse-categories-panel")[0];
        if (optionsPanel) {
          var msg = _generateMessage(min,max);
          optionsPanel.insert({before: msg});
          Event.fire(document, 'xwiki:dom:updated', {'elements' : [module]});
          var options = optionsPanel.select('input[type="checkbox"],input[type="radio"]');

          var callback = _selectionSync.bind(this, min, max, options, msg);
          module.__validationCallback = callback;

          callback();
          options.invoke('observe', 'click', callback);
        }
      }
      module.addClassName('initialized');
    });
    var temp = function() {
      $$('.parent-summary-group').invoke('observe', 'parent:term:deleted', onTermDeleted);
    };
    temp.delay(0.5);
    document.observe('parent:dialog:added', function(event) {
      event.memo.element &amp;&amp; event.memo.element.up('table').observe('parent:term:deleted', onTermDeleted);
    });
  };
  (XWiki.domIsLoaded &amp;&amp; init()) || document.observe("xwiki:dom:loaded", init);
}());</code>
    </property>
    <property>
      <name>Validate minimum and maximum choices</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>11</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>d8b496b2-a549-42db-97e6-36e04e0b8aa6</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>document.observe('parent:dialog:added', function(event) {
  event.memo.element &amp;&amp; event.memo.element.down('.date_recommended .fuzzy-date-picker') &amp;&amp; $$('.result_reported_date input.fuzzy-date')[0] &amp;&amp; event.memo.element.down('.date_recommended .fuzzy-date-picker')._setValue(JSON.parse($$('.result_reported_date input.fuzzy-date')[0].next().value))
});</code>
    </property>
    <property>
      <name>Set dates to the WES reports data</name>
    </property>
    <property>
      <parse/>
    </property>
    <property>
      <use>currentPage</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>32a05e52-7c49-4f3d-a80a-dc319dda42af</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>6</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>3</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>1</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>5</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>4</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>#template('colorThemeInit.vm')

.main dl {
  margin: 1em 0 1em 2em;
}

.main table {
  margin: 0;
}

.table {
  display: table;
  width: 100%;
  border-collapse: separate;
  border-spacing: 2.5px;
}

.table-row {
  display: table-row;
}

.table-cell {
  display: table-cell;
}

.menu-horizontal &gt; ul ul {
  margin: .25em 0 0 -6.7em;
}

input[type='checkbox'],
input[type='radio'] {
  margin-right: .5em;
}
/**********************************************************************************************
 * Survey css.
 */

.care-pathways-loading {
  display: inline-block;
  width: 100%;
  text-align: center;
  font-weight: bold;
  padding: 1em 0 1em 0;;
  background-color: $theme.borderColor;
}
.care-pathways-questionnaire.generating .care-pathways-module-group-container {
  display: none;
}
table.care-pathways-module-group-container,
table.care-pathways-analysis-container {
  border-collapse: separate;
  border-spacing: 2.5px;
  background-color: $theme.borderColor;
  margin: 0;
}
tr.care-pathways-modules td.selector-panel {
  background-color: $theme.pageContentBackgroundColor;
  padding: 0;
}
tr.care-pathways-modules td.cp-categories {
  vertical-align: top;
  width: 30%;
  min-width: 400px;
}
tr.care-pathways-modules td.cp-categories div.cp-categories-panel li.term-entry span.expand-tool {
  margin: 0.5em;
  font-size: inherit;
}
tr.care-pathways-modules td.cp-current-selection {
  vertical-align: top;
}
tr.care-pathways-modules td.cp-current-selection div.current-selection-panel {
  padding-left: 15px;
}
tr.care-pathways-section-label {
  height: 2.0em;
  color: #000;
  font-size: 130%;
}
tr.care-pathways-section-label td {
  padding: 10px 10px 0 10px;
}
tr.care-pathways-modules li &gt; h3,
tr.care-pathways-modules td &gt; h3 {
  font-size: 0.8em;
  letter-spacing: 0;
  margin: 0 !important;
  padding: 5px 20px 5px 15px;
  text-align: left;
  text-transform: uppercase;
  background-color: $theme.fieldGradientColor;
  color: $theme.panelHeaderTextColor;
  text-shadow: 0 1px 0 $theme.panelHeaderGradientColor;
}
/**********************************************************************************************
 * Qualifiers css.
 */

table.summary-group {
  width: 90%;
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}
table.terms-data-table {
  max-width: 700px;
  width: 100%;
  margin: 0;
}
table.terms-data-table tr td {
  border: none;
}
table.summary-group td.add-button-holder span.patient-details-add {
  float: left;
  margin-left: 2em;
  font-size: 87.5%;
}
table.summary-group span.action-done,
table.summary-group span.action-edit {
  float: right;
}
table.summary-group div.summary-item {
  background-color: $theme.panelCollapsedBackgroundColor;
  background-position: left center;
  background-repeat: no-repeat;
  border-radius: 0 .5em .5em .5em;
  border: 1px solid #FFF;
  color: $theme.textColor;
  font-size: 87.5%;
  margin-left: 20px;
  padding: .5em 20px;
  position: relative;
}
table.summary-group div.summary-item.blurred {
  cursor: pointer;
}
div.summary-item div.clearfloats {
  margin: 0;
}
table.summary-group div.summary-item span.parent-dialog-delete,
table.summary-group tr.term-holder span.patient-term-delete {
  color: $theme.notificationErrorColor;
}

.care-pathways-module-container-view table.summary-group tr.term-holder label {
  width: 100%;
  font-weight: normal;
  margin-left: .5em;
}

.care-pathways-module-container-view table.terms-data-table td.no-data {
  padding: 1em;
}

div.fuzzy-date-picker {
  display: inline-block;
  padding: 2px;
  border: 1px solid transparent;
}

tr.care-pathways-module-container table.summary-group div.summary-item span.parent-paste-last-date-button {
  margin-left: .5em;
  cursor: pointer;
}

tr.care-pathways-module-container table.summary-group div.summary-item.blurred dl,
tr.care-pathways-module-container-view table.summary-group div.summary-item dl {
  display: inline-block;
  margin: .2em;
  vertical-align: middle;
}
tr.care-pathways-module-container table.summary-group div.summary-item.blurred dt,
tr.care-pathways-module-container-view table.summary-group div.summary-item dt {
  margin: 2px 0 2px .5em;
  border-bottom-left-radius: .3em;
  border-top-left-radius: .3em;
}
tr.care-pathways-module-container table.summary-group div.summary-item.blurred dl:first-child,
tr.care-pathways-module-container-view table.summary-group div.summary-item dl:first-child {
  margin-left: 0;
}
tr.care-pathways-module-container table.summary-group div.summary-item.blurred dd,
tr.care-pathways-module-container-view table.summary-group div.summary-item dd {
  margin: 2px 0;
  border-bottom-right-radius: .3em;
  border-top-right-radius: .3em;
}
tr.care-pathways-module-container table.summary-group div.summary-item.blurred dt.hidden + dd + dd.preview,
tr.care-pathways-module-container-view table.summary-group div.summary-item dt.hidden + dd {
  margin: 0;
  border-bottom-left-radius: .3em;
  border-top-left-radius: .3em;
}
tr.care-pathways-module-container table.summary-group div.summary-item.blurred dt,
tr.care-pathways-module-container table.summary-group div.summary-item.blurred dd,
tr.care-pathways-module-container-view table.summary-group div.summary-item dt,
tr.care-pathways-module-container-view table.summary-group div.summary-item dd {
  display: inline-block;
  background-color: $theme.pageContentBackgroundColor;
  float: left;
  padding: .3em;
  clear: none;
}
tr.care-pathways-module-container table.summary-group div.summary-item dt,
tr.care-pathways-module-container table.summary-group div.summary-item dd {
  margin-top: .4em;
  margin-bottom: .4em;
}
tr.care-pathways-module-container table.summary-group div.summary-item dt {
  float: left;
  clear: left;
}
tr.care-pathways-module-container table.summary-group div.summary-item.focused dt:not(.inline) {
  width: 100%;
}
tr.care-pathways-module-container table.summary-group div.summary-item.blurred p.cp-hideable-warningmessage {
  display: none;
}
table.summary-group div.summary-item.focused dt.collapsible span.selected-value {
  font-weight: normal;
  margin-left: .5em;
}
table.summary-group div.summary-item.focused dt.collapsible span.collapse-button {
  margin-right: .5em;
}
table.summary-group div.summary-item.focused dd.comments textarea {
  min-height: 50px;
}
table.summary-group div.summary-item.focused dt.inline {
  margin-right: .5em;
}
table.summary-group div.summary-item.blurred dd,
table.summary-group div.summary-item.focused dd.inline {
  float: left;
}
table.summary-group div.summary-item.focused dd.inline select {
  padding: 0;
}
table.summary-group div.summary-item ul {
  list-style-type: none;
  padding-left: 1em;
  margin-left: 0;
}
.category-data .clickable:hover {
  cursor: pointer;
}
.category-data label.clickable.disabled {
  color: #CCC;
  cursor: default;
}
table.summary-group td.add-button-holder span.patient-details-add {
  cursor: pointer;
}
/**********************************************************************************************
 * Typeahead css.
 */

table.summary-group div.summary-item.focused dd.inline.datum,
table.summary-group div.summary-item.focused dd.inline.laboratory {
  width: 60%;
}
span.scrollable-typeahead {
  width: 100%;
}
span.twitter-typeahead {
  width: 100%;
}
span.scrollable-typeahead div.tt-menu {
  max-height: 100px;
  overflow-y: auto;
  width: 100%;
  background-color: $theme.pageContentBackgroundColor;
  border: solid 1px $theme.backgroundSecondaryColor;
  border-radius: 5px;
}
span.scrollable-typeahead div.tt-menu div.tt-suggestion {
  padding: 2.5px 10px;
  cursor: pointer;
}
span.scrollable-typeahead div.tt-menu h3.user-entered-data {
  color: $theme.panelHeaderTextColor;
  margin: 0;
  padding: 0 10px;
  font-size: inherit;
  background-color: $theme.highlightColor;
}

/**********************************************************************************************
* Fuzzy date picker css.
*/
.fuzzy-date-picker select {
  font-family: Arial,Verdana,sans-serif;
}
.fuzzy-date-picker .year {
  font-size: 14px;
  max-width: 68px;
}
.fuzzy-date-picker .month {
  font-size: 14px;
  max-width: 48px;
}
.fuzzy-date-picker .day {
  font-size: 14px;
  max-width: 48px;
}
.fuzzy-date-picker .empty {
  font-size: .7em;
  opacity: .5;
}
.fuzzy-date-picker .year option {
  /*text-indent: 1em;*/
}
.fuzzy-date-picker .year .decade {
  font-weight: bold;
  /*text-indent: 0;*/
}
.fuzzy-date-picker .year .century {
  font-weight: bold;
  /*text-indent: 0;*/
}
.fuzzy-date-picker .year:disabled {
  opacity: .5 !important;
}
.fuzzy-date-picker .month:disabled {
  opacity: .5 !important;
}
.fuzzy-date-picker .day:disabled {
  opacity: .5 !important;
}

/**********************************************************************************************
* Selects validation css.
*/
select.LV_invalid_field,
div.fuzzy-date-picker.invalid {
  background-color: $theme.highlightColor !important;
  border: 1px solid $theme.notificationErrorColor;
  color: $theme.textColor !important;
}
select + .LV_validation_message {
  float: right;
}
.LV_validation_message {
  line-height: 1em;
}

.care-pathways-form.cp-secondary table.cp-primary,
.care-pathways-form.cp-primary table.cp-secondary {
  display:none;
}
.care-pathways-form.cp-undefined table.care-pathways-module-group-container,
.care-pathways-form:not(.initialized) table.care-pathways-module-group-container {
  display: none;
}

#primary-variants-interpretation-container label.associated-data-field-label {
  margin-left: 28px;
  margin-top: 1em;
  display: inline-block;
}
.timeline, .eligibility {
  padding: .5em 28px;
}

.eligibility label {
  display: block;
}

label[for$="CP:22_other"] {
  display: none !important;
}
label[for$="CP:21_other"]::after,
label[for$="CP:213"]::after,
label[for$="CP:232_other"]::after,
label[for$="CP:2334_other"]::after,
label[for$="CP:2352_other"]::after,
label[for$="CP:23_other"]::after,
label[for$="CP:24_other"]::after,
label[for$="CP:25_other"]::after,
label[for$="CP:26_other"]::after,
label[for$="CP:2345_other"]::after,
label[for$="CP:2317_other"]::after {
  content: " (specify test)";
}
label[for$="CP:222"]::after {
  content: " (specify panel and number of genes)";
}
label[for$="CP:221"]::after {
  content: " (specify gene)";
}
label[for$="CP:251_other"]::after,
label[for$="CP:257_other"]::after,
label[for$="CP:259_other"]::after,
label[for$="CP:2515_other"]::after,
label[for$="CP:2523_other"]::after {
  content: " (specify region)";
}
label[for$="CP:2359"]::after {
  content: " (specify type and sample type)";
}
label[for$="CP:2349"]::after,
label[for$="CP:2350"]::after {
  content: " (specify enzymes)";
}
label[for$="CP:31_other"]::after {
  content: " (specify subspecialty)";
}
label[for$="CP:32_other"]::after {
  content: " (specify allied health care)";
}

.cp-categories-panel label.controller {
  display: block;
  margin: 1em 0 -1em 2em;
}

.cp-current-selection-panel .dialog-holder ul {
  margin: 0;
}</code>
    </property>
    <property>
      <contentType>CSS</contentType>
    </property>
    <property>
      <name>Care Pathways survey styles</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>1</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>d31fabab-df3e-42df-b82e-39cb0866166d</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>6</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>3</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>1</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>5</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>4</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>#template('colorThemeInit.vm')

tr.family-care-subtitle .table-cell,
tr.care-pathways-family-module-container .table-cell,
tr.care-pathways-family-module-container-view .family-test-data.table-cell {
  padding: 1em 1em 1em 2em;
}

tr.care-pathways-family-module-container-view td.family-test-data table td {
  border: none;
}

tr.care-pathways-family-module-container .table-cell,
tr.care-pathways-family-module-container-view .table-cell {
  background-color: $theme.pageContentBackgroundColor;
}

tr.care-pathways-family-module-container .term-picker {
  padding: 10px 0 10px 0;
  width: 6em;
  display: inline-block;
  text-align: center;
  cursor: pointer;
  border: 1px solid;
  border-color: $theme.buttonSecondaryBackgroundColor;
  color: $theme.textColor;
}

tr.care-pathways-family-module-container .term-picker input {
  padding: 0;
  margin: 0 .5em 0 0;
}

tr.care-pathways-family-module-container-view .affected-family-member {
  padding: 5px;
  width: 60px;
  text-align: center;
}

tr.care-pathways-family-module-container-view .family-test-name {
  width: 290px;
}

tr.care-pathways-family-module-container-view .affected-family-member,
tr.care-pathways-family-module-container .term-picker.selected {
  background-color: $theme.panelCollapsedBackgroundColor;
}

(tr.care-pathways-family-module-container .term-picker) + (tr.care-pathways-family-module-container .term-picker) {
  margin: 0 .1em 0 .1em;
}

tr.family-care-subtitle .table-cell {
  padding: 1em 0 .5em .5em;
}</code>
    </property>
    <property>
      <contentType>CSS</contentType>
    </property>
    <property>
      <name>Care Pathways picker widget</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>2</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>2ab5cd5d-79d9-4098-b3c2-756d26f6ce82</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>6</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>3</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>1</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>5</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>4</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>.cp-categories .selection-restriction-msg {
  font-size: 0.8em;
  color: #D00;
  margin: 0 0 1em 15px;
}
.cp-categories .selection-restriction-msg.satisfied {
  color: #0A0;
}
.mandatory.selection-restriction-msg input, .mandatory.selection-restriction-msg .fa {
  display:none;
}
.mandatory.selection-restriction-msg.satisfied .fa-check,
.mandatory.selection-restriction-msg:not(.satisfied) .LV_invalid + .fa-exclamation-triangle {
  display:inline-block;
}</code>
    </property>
    <property>
      <contentType>CSS</contentType>
    </property>
    <property>
      <name>Minimum and maximum choice validation styling</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathways</name>
    <number>3</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>e5e014f9-09e7-49fd-bed3-7d2d1442c6fe</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>6</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>3</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>1</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>5</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>4</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>.date_pursued .month, .date_pursued .day {
  display:none;
}</code>
    </property>
    <property>
      <contentType>CSS</contentType>
    </property>
    <property>
      <name>Hide month and day from datepickers</name>
    </property>
    <property>
      <parse/>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
</xwikidoc>
