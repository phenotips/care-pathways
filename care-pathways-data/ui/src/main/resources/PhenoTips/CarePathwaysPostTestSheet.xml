<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see http://www.gnu.org/licenses/
-->

<xwikidoc version="1.1">
  <web>PhenoTips</web>
  <name>CarePathwaysPostTestSheet</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1511381166000</creationDate>
  <parent>PhenoTips.PatientSheet</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1511385757000</date>
  <contentUpdateDate>1511385757000</contentUpdateDate>
  <version>1.1</version>
  <title/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content>{{include reference="PhenoTips.PatientSheetMacros" /}}

{{include reference="PhenoTips.FormMacros" /}}

{{include reference="PhenoTips.CarePathways" /}}

{{include reference="PhenoTips.TabelarDataMacros" /}}

{{include reference="PhenoTips.CarePathwaysDataDeleteServices" /}}

{{velocity output="false"}}
$xwiki.ssx.use('PhenoTips.PatientSheetCode', {'colorTheme' : "$xwiki.getSpacePreference('colorTheme')"})##
$xwiki.ssx.use('PhenoTips.CarePathways')##
$xwiki.ssx.use('PhenoTips.CarePathwaysPostTestSheet')##
$xwiki.ssfx.use('uicomponents/widgets/extraGeneVariantData.css', true)##
$xwiki.jsx.use('PhenoTips.UIX_Field__gene-variants')##
$xwiki.jsx.use('PhenoTips.CarePathways')##
#if ($xcontext.action == 'edit')
$xwiki.jsx.use('PhenoTips.CarePathwaysPostTestSheet')##
$xwiki.jsfx.use('uicomponents/widgets/extraGeneVariantData.js', true)##
$xwiki.jsfx.use('uicomponents/widgets/geneVariantValidation.js', true)##
$xwiki.jsfx.use('uicomponents/widgets/validation/scrollValidation.js')##
#end
#template('geneVariantMacros.vm')##
{{/velocity}}

{{include reference="PhenoTips.CarePathwaysGeneTableMacros" /}}##

{{velocity output="false"}}
#set ($displayDocExtra = false)
##
##
#set($obj = $doc.getObject('PhenoTips.CarePathwaysPostTestSheet', true))
#set($class = $obj.xWikiClass)
#set($discard = $doc.use($obj))
## Disable the Preview button
#set($previewenabled = false)
##
##
#set ($geneStatus = 'confirmed')##
#set ($variantStatus = "primary")##
#set ($section = "posttest")
#set ($storageClass = "PhenoTips.PatientCarePostTestClass")
#set ($posttestQuestions = [
      {
         'question':'CPQ:8',
         'modules':[
            {
               'dates':[],
               'module':'sequencing',
               'type':'1block',
               'subject':'proband'
            }
         ]
      },
      {
         'question':'CPQ:9',
         'modules':[
            {
               'module':'timeline',
               'submodule' : 'posttest',
               'type':'1block',
               'subject':'proband'
            }
         ]
      },
      {
         'question':'CPQ:16',
         'modules':[
            {
               'module':'variants',
               'submodule' : 'primary',
               'type':'1block',
               'subject':'proband'
            }
         ]
      },
      {
         'question':'CPQ:17',
         'modules':[
            {
               'module':'variants',
               'submodule' : 'analysis',
               'type':'1block',
               'subject':'proband'
            }
         ]
      },
      {
         'question':'CPQ:18',
         'modules':[
            {
               'module':'variants',
               'submodule' : 'vus',
               'geneStatus' : 'candidate',
               'variantStatus' : 'candidate',
               'type':'1block',
               'subject':'proband'
            }
         ]
      },
      {
         'question':'CPQ:19',
         'modules':[
            {
               'module':'variants',
               'submodule' : 'secondary',
               'geneStatus' : 'confirmed_secondary',
               'variantStatus' : 'secondary',
               'type':'1block',
               'subject':'trio'
            }
         ]
      },
      {
         'question':'CPQ:20',
         'formType': 'primary',
         'modules':[
            {
              "dates":[
                 {
                   "name":"date_recommended",
                   "label":"$!escapetool.xml($services.localization.render('phenotips.carePathways.care.detailsDialog.datePicker.date_recommended.title'))"
                 }
               ],
               'module':'test',
               'hasPursued':true
            }
         ]
      },
      {
         'question':'CPQ:21',
         'formType': 'primary',
         'modules':[
            {
               'module':'test'
            }
         ]
      },
      {
         'question':'CPQ:22',
         'formType': 'primary',
         'modules':[
            {
              "module" : "care",
              "dates":[
                {
                  "name":"date_recommended",
                  "label":"$!escapetool.xml($services.localization.render('phenotips.carePathways.care.detailsDialog.datePicker.date_recommended.title'))"
                }
              ],
              'hasPursued':true
            },
            {
              "module" : "relatives",
              "type" : "1block",
              "submodule" : "primary"
            }
         ]
      },
      {
         'question':'CPQ:23',
         'formType': 'primary',
         'modules':[
            {
              "dates":[
                 {
                   "name":"date_recommended",
                   "label":"$!escapetool.xml($services.localization.render('phenotips.carePathways.care.detailsDialog.datePicker.date_recommended.title'))"
                 }
               ],
               'module':'test',
               'hasPursued':true
            }
         ]
      },
      {
         'question':'CPQ:24',
         'formType': 'primary',
         'modules':[
            {
              "module" : "care",
              "dates":[
                {
                  "name":"date_recommended",
                  "label":"$!escapetool.xml($services.localization.render('phenotips.carePathways.care.detailsDialog.datePicker.date_recommended.title'))"
                }
              ],
              'hasPursued':true
            },
            {
              "module" : "relatives",
              "type" : "1block",
              "submodule" : "secondary"
            }
         ]
      },
      {
         'question':'CPQ:25',
         'formType': 'secondary',
         'modules':[
            {
              "module" : "followUp",
              "type" : "1block"
            }
         ]
      }
   ]
)
##
##
##
##
##
#macro (__displayPostTestSurvey)
  #set ($section = "posttest")
  #set ($sheet = "$!{class.name}")
  #set ($storageClass = "PhenoTips.PatientCarePostTestClass")
  #set ($clearCategory = $doc.getURL("get", "sheet=$sheet&amp;cpclassname=${storageClass}&amp;action=clearcategory&amp;question=xXx__QUESTION_TEMPLATE__xXx&amp;category=xXx__CATEGORY_TEMPLATE__xXx&amp;form_token=$!{services.csrf.getToken()}"))
  #set ($deleteQualifier = $doc.getURL("objectremove", "classname=${storageClass}&amp;classid=xXx__COUNT_TEMPLATE__xXx&amp;form_token=$!{services.csrf.getToken()}"))
  {{html clean="false" wiki="false"}}##
  &lt;div id="${section}-questionnaire" class="care-pathways-questionnaire care-pathways-form"&gt;
  &lt;input type="hidden" id="delete-qualifier-action" value="$deleteQualifier"/&gt;
  &lt;input type="hidden" id="clear-category-action" value="$clearCategory"/&gt;
  #foreach ($question in $posttestQuestions)
    &lt;table id="modules-for-$!{question.question}" class="${section}-section table care-pathways-module-group-container chapter#if ($question.formType) cp-$question.formType#end"&gt;
      &lt;tr class="table-row care-pathways-section-label"&gt;
        &lt;td class="table-cell" colspan="2"&gt;
          &lt;input type="hidden" class="cp-question-id" value="$!{question.question}"/&gt;
          $!{services.vocabularies.care-pathways-questions.getTerm($question.question).name}
        &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr class="care-pathways-modules"#if ($question.get('selection-min')) data-selection-min="$question.get('selection-min')"#end#if ($question.get('selection-max')) data-selection-max="$question.get('selection-max')"#end&gt;
        &lt;td&gt;
          &lt;table class="table care-pathways-modules-wrapper no-variants"&gt;
            #set ($lastIdx = $question.modules.size() - 1)
            #set ($editable = ($xcontext.action == "edit"))##
            #__displayModuleGroup($question.question, '', '', $question.modules, ${lastIdx}, $sheet, $storageClass, true, $editable)
          &lt;/table&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
  #end
  &lt;/div&gt;
  {{/html}}##
#end
{{/velocity}}

{{velocity}}
  {{html clean="false" wiki="false"}}
    #set ($clearCategory = $doc.getURL("get", "sheet=$!{class.name}&amp;cpclassname=${storageClass}&amp;action=clearcategory&amp;question=xXx__QUESTION_TEMPLATE__xXx&amp;category=xXx__CATEGORY_TEMPLATE__xXx&amp;form_token=$!{services.csrf.getToken()}"))##
    #set ($deleteQualifier = $doc.getURL("objectremove", "classname=${storageClass}&amp;classid=xXx__COUNT_TEMPLATE__xXx&amp;form_token=$!{services.csrf.getToken()}"))##
    #set ($getMatchingVariant = $xwiki.getURL("PhenoTips.CarePathwaysVariantSearch", "get", "id=$!{doc.name}"))
    &lt;input type="hidden" id="delete-qualifier-action" value="$deleteQualifier"/&gt;
    &lt;input type="hidden" id="clear-category-action" value="$clearCategory"/&gt;
    &lt;input type="hidden" id="matching-patient-variants-url" value="$getMatchingVariant"/&gt;
  {{/html}}##
{{/velocity}}

{{velocity}}
(% id="care-pathways-posttest-container"%)(((##
#if ("$!{services.vocabularies.care-pathways-questions.version}" == '')

  {{error}}This extension isn't fully installed yet.#if ($hasAdmin) You#else An administrator#end **must reindex** the "Care pathways tests and patient care" and "Care pathways survey questions" ontologies#if ($hasAdmin) in the [[administrative UI&gt;&gt;path:$xwiki.getURL('XWiki.XWikiPreferences', 'admin', 'editor=globaladmin&amp;section=Vocabulary', '')]]#end.{{/error}}

  {{html clean="false" wiki="false"}}
    &lt;input type='hidden' name="returnTo" value='#if ($supported_actions.contains("$!request.returnTo"))${request.returnTo}#{else}edit#{end}'/&gt;
    &lt;input type='hidden' id='current-tab-id' value='care-pathways-posttest-tab'/&gt;
  {{/html}}
  #break
#end
(% class="box infomessage" %)
These questions should be completed following whole exome testing

(% class="cp-site-selection" %)(((
  == Enrollment Site for Patient ==
  #set ($enrollmentObject = $doc.getObject('PhenoTips.CarePathwaysEnrollmentClass', true))
  $doc.display('enrollment', $enrollmentObject)
)))

#__displayPostTestSurvey()
##)))

{{html clean="false" wiki="false"}}
  #set ($clearQuestions = $doc.getURL("get", "sheet=$!{class.name}&amp;action=cpclearquestions&amp;classname=PhenoTips.PatientCarePostTestClass&amp;form_token=$!{services.csrf.getToken()}"))
  &lt;input type='hidden' id='clear-questions-data' value="${clearQuestions}"/&gt;
  &lt;input type='hidden' id='data-storage-class' value="PhenoTips.PatientCarePostTestClass"/&gt;
  &lt;input type='hidden' id='prefix' value='$!{class.name}_$!{obj.number}_'/&gt;
  &lt;input type='hidden' id='current-tab-id' value='care-pathways-posttest-tab'/&gt;
  &lt;input type='hidden' name="objectPolicy" value='updateOrCreate'/&gt;
  #set ($supported_actions = ['edit', 'view'])
  &lt;input type='hidden' name="returnTo" value='#if ($supported_actions.contains("$!request.returnTo"))${request.returnTo}#{else}edit#{end}'/&gt;
  &lt;input type='hidden' name="cpredirect" value="$escapetool.xml($doc.getURL("view", "sheet=$!{class.name}&amp;returnTo=view"))"/&gt;
  &lt;input type='hidden' name="cpActionEdit" value="$escapetool.xml($doc.getURL("edit", "sheet=$!{class.name}&amp;returnTo=edit"))"/&gt;
{{/html}}##
)))
{{/velocity}}</content>
  <class>
    <name>PhenoTips.CarePathwaysPostTestSheet</name>
    <customClass/>
    <customMapping/>
    <defaultViewSheet/>
    <defaultEditSheet/>
    <defaultWeb/>
    <nameField/>
    <validationScript/>
    <additionalDiagnosticTestingAvoided>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>select</displayFormType>
      <displayType/>
      <name>additionalDiagnosticTestingAvoided</name>
      <number>17</number>
      <prettyName>Was additional diagnostic testing avoided?</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </additionalDiagnosticTestingAvoided>
    <additionalDiagnosticTestingOrdered>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>select</displayFormType>
      <displayType/>
      <name>additionalDiagnosticTestingOrdered</name>
      <number>16</number>
      <prettyName>Was additional diagnostic testing ordered?</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </additionalDiagnosticTestingOrdered>
    <cascadeTestingRecommended>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>select</displayFormType>
      <displayType/>
      <name>cascadeTestingRecommended</name>
      <number>22</number>
      <prettyName>Was cascade testing for family member(s) recommended?</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </cascadeTestingRecommended>
    <diseases>
      <cache>0</cache>
      <customDisplay>{{velocity}}
$xwiki.jsx.use('PhenoTips.PatientSheetCode')##
$xwiki.ssx.use('PhenoTips.PatientSheetCode')##
(% class="displayed-value"%)(((
#if ($xcontext.action == 'edit')
  {{html wiki=false clean=false}}
  &lt;div class="custom-display-data"&gt;
  #foreach ($val in $value)
    #set($notMapped = 'notmapped')
    #set ($term = $!services.vocabularies.omim.getTerm($val))
    #set ($entryName = $val)
    #if ($term)
      #set ($notMapped = '')
      #set ($entryName = $stringtool.defaultIfBlank("$!{term.name}", $val))
    #end
    &lt;label class="term-entry $notMapped" for="${prefix}${name}_${escapetool.xml($val)}"&gt;
      &lt;input title="${escapetool.xml($entryName)}" type="checkbox" checked="checked" name="${prefix}${name}" id="${prefix}${name}_${escapetool.xml($val)}" value="${escapetool.xml($val)}"/&gt;${escapetool.xml($entryName)}
    &lt;/label&gt;
  #end
  &lt;/div&gt;
  &lt;input type="text" name="${prefix}${name}" id="${prefix}${name}" value="" class="suggested suggest-omim multi generateShortList"/&gt;
  &lt;input type="hidden" name="${prefix}${name}" value=""/&gt;
  {{/html}}
#elseif ($value &amp;&amp; $value.size() &gt; 0 &amp;&amp; "${value.get(0)}" != '')
  #foreach ($val in $value)
    #set ($term = $!services.vocabularies.omim.getTerm($val))
    #if ($term)
      #set ($name = $term.name)
      #set ($termId = $term.id)
      #if ("$!{name}" == '')
        #set ($name = $val)
      #end
      #if ($termId.indexOf(':') &gt;= 0)
        #set ($termId = $stringtool.substringAfter($termId, ':'))
      #end
      (% class="vocabulary-term-list" %)((([[~$!{stringtool.defaultString($!term.symbol, ' ')}${term.id}&gt;&gt;http://www.omim.org/entry/${termId}||class="term-id"]] $!{services.rendering.escape($name, $doc.syntax)})))
    #else
      #set ($name = $val)
      #set ($termId = $val)
      (% class="vocabulary-term-list" %)((((% class="term-id" %)((({{icon name="fa fa-exclamation-triangle fa-fw" title="$services.localization.render('phenotips.patientSheetCode.termSuggest.nonStandardDisorder')"/}} $!{services.rendering.escape($name, $doc.syntax)}))))))
    #end
  #end
#end
)))
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <displayType>select</displayType>
      <multiSelect>1</multiSelect>
      <name>diseases</name>
      <number>5</number>
      <picker>0</picker>
      <prettyName>Diseases</prettyName>
      <relationalStorage>1</relationalStorage>
      <separator> </separator>
      <separators>|, </separators>
      <size>1</size>
      <sort>none</sort>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <values/>
      <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
    </diseases>
    <firstDegreeCounsellingPrimary>
      <customDisplay>{{velocity}}
#if ($type == 'edit')
{{html}}
&lt;select name="$prefix$name"&gt;
&lt;option value=""#if ("$!value" == '') selected="selected"#end&gt;&lt;/option&gt;
#foreach ($i in [0..99])
&lt;option value="$i"#if ($value == $i) selected="selected"#end&gt;$i&lt;/option&gt;
#end
&lt;/select&gt;
{{/html}}
#else
$!value
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <name>firstDegreeCounsellingPrimary</name>
      <number>8</number>
      <picker>0</picker>
      <prettyName>Number of 1st degree relatives counselled</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </firstDegreeCounsellingPrimary>
    <firstDegreeCounsellingSecondary>
      <customDisplay>{{velocity}}
#if ($type == 'edit')
{{html}}
&lt;select name="$prefix$name"&gt;
&lt;option value=""#if ("$!value" == '') selected="selected"#end&gt;&lt;/option&gt;
#foreach ($i in [0..99])
&lt;option value="$i"#if ($value == $i) selected="selected"#end&gt;$i&lt;/option&gt;
#end
&lt;/select&gt;
{{/html}}
#else
$!value
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <name>firstDegreeCounsellingSecondary</name>
      <number>9</number>
      <picker>0</picker>
      <prettyName>Number of 1st degree relatives counselled</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </firstDegreeCounsellingSecondary>
    <firstDegreeTestingPrimary>
      <customDisplay>{{velocity}}
#if ($type == 'edit')
{{html}}
&lt;select name="$prefix$name"&gt;
&lt;option value=""#if ("$!value" == '') selected="selected"#end&gt;&lt;/option&gt;
#foreach ($i in [0..99])
&lt;option value="$i"#if ($value == $i) selected="selected"#end&gt;$i&lt;/option&gt;
#end
&lt;/select&gt;
{{/html}}
#else
$!value
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <name>firstDegreeTestingPrimary</name>
      <number>10</number>
      <picker>0</picker>
      <prettyName>Number of 1st degree relatives tested</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </firstDegreeTestingPrimary>
    <firstDegreeTestingSecondary>
      <customDisplay>{{velocity}}
#if ($type == 'edit')
{{html}}
&lt;select name="$prefix$name"&gt;
&lt;option value=""#if ("$!value" == '') selected="selected"#end&gt;&lt;/option&gt;
#foreach ($i in [0..99])
&lt;option value="$i"#if ($value == $i) selected="selected"#end&gt;$i&lt;/option&gt;
#end
&lt;/select&gt;
{{/html}}
#else
$!value
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <name>firstDegreeTestingSecondary</name>
      <number>11</number>
      <picker>0</picker>
      <prettyName>Number of 1st degree relatives tested</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </firstDegreeTestingSecondary>
    <genes>
      <cache>0</cache>
      <customDisplay>{{velocity}}
$xwiki.jsx.use('PhenoTips.PatientSheetCode')##
$xwiki.ssx.use('PhenoTips.PatientSheetCode')##
(% class="displayed-value"%)(((
#if ($xcontext.action == 'edit')
  {{html wiki=false clean=false}}
  &lt;div class="custom-display-data"&gt;
  #foreach ($val in $value)
    #set($notMapped = 'notmapped')
    #set ($term = $!services.vocabularies.hgnc.getTerm($val))
    #set ($entryName = $val)
    #if ($term)
      #set ($notMapped = '')
      #set ($entryName = $stringtool.defaultIfBlank("$!{term.symbol}", $val))
    #end
    &lt;label class="term-entry $notMapped" for="${prefix}${name}_${escapetool.xml($val)}"&gt;
      &lt;input title="${escapetool.xml($entryName)}" type="checkbox" checked="checked" name="${prefix}${name}" id="${prefix}${name}_${escapetool.xml($val)}" value="${escapetool.xml($val)}"/&gt;${escapetool.xml($entryName)}
    &lt;/label&gt;
  #end
  &lt;/div&gt;
  &lt;input type="text" name="${prefix}${name}" id="${prefix}${name}" value="" class="suggest-genelist"/&gt;
  &lt;input type="hidden" name="${prefix}${name}" value=""/&gt;
  {{/html}}
#elseif ($value &amp;&amp; $value.size() &gt; 0 &amp;&amp; "${value.get(0)}" != '')
  #foreach ($val in $value)
    #set ($term = $!services.vocabularies.hgnc.getTerm($val))
    #if ($term)
      #set ($name = $term.symbol)
      #set ($termId = $term.id)
      #if ("$!{name}" == '')
        #set ($name = $val)
      #end
      #if ($termId.indexOf(':') &gt;= 0)
        #set ($termId = $stringtool.substringAfter($termId, ':'))
      #end
      (% class="vocabulary-term-list" %)((($!{services.rendering.escape($name, $doc.syntax)})))
    #else
      #set ($name = $val)
      #set ($termId = $val)
      (% class="vocabulary-term-list" %)((((% class="term-id" %)((({{icon name="fa fa-exclamation-triangle fa-fw" title="$services.localization.render('phenotips.patientSheetCode.termSuggest.nonStandardDisorder')"/}} $!{services.rendering.escape($name, $doc.syntax)}))))))
    #end
  #end
#end
)))
{{/velocity}}

{{velocity output="false"}}
$xwiki.jsx.use('PhenoTips.PatientSheetCode')##
$xwiki.ssx.use('PhenoTips.PatientSheetCode')##
#macro (_displayGeneSymbol $prefix $name $value)
  #set ($termStatus = "")
  #set ($gene = {'id' : $!{escapetool.xml($value)}})
  #set ($term = $services.vocabularies.hgnc.getTerm("${gene.id}"))
  #if ($term)
    #set ($gene.symbol = $term.symbol)
  #else
    #set ($termStatus = "notmapped")
    #set ($gene.symbol = $gene.id)
  #end
  #set ($placeholder = $services.localization.render('Phenotips.GeneClass.geneNamePlaceholder'))
  #if ($xcontext.action == 'edit')
    {{html wiki="false" clean="false"}}&lt;input type='text' name='${prefix}symbol' class='suggested suggest-gene gene-name' placeholder='$placeholder' size='16' value='$!{gene.symbol}'/&gt;{{/html}}
  #else
    ${gene.symbol}#if("$!{gene.symbol}" != ''){{html wiki="false" clean="false"}}&lt;input type='hidden' name='gene_name' class='gene-name $!termStatus' value="$!{gene.symbol}"/&gt;{{/html}}#end
  #end
#end
##
##
#if ($prefix &amp;&amp; $name)
#_displayGeneSymbol($prefix, $name, $value)
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <displayType>input</displayType>
      <multiSelect>1</multiSelect>
      <name>genes</name>
      <number>4</number>
      <picker>0</picker>
      <prettyName>Genes</prettyName>
      <relationalStorage>1</relationalStorage>
      <separator> </separator>
      <separators>|, </separators>
      <size>1</size>
      <sort>none</sort>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <values/>
      <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
    </genes>
    <noPrimaryVariants>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>checkbox</displayFormType>
      <displayType/>
      <name>noPrimaryVariants</name>
      <number>1</number>
      <prettyName>No primary variants</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </noPrimaryVariants>
    <noSecondaryVariants>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>checkbox</displayFormType>
      <displayType/>
      <name>noSecondaryVariants</name>
      <number>2</number>
      <prettyName>No secondary variants</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </noSecondaryVariants>
    <noVusVariants>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>checkbox</displayFormType>
      <displayType/>
      <name>noVusVariants</name>
      <number>7</number>
      <prettyName>No candidate variants</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </noVusVariants>
    <partialDiagnosisExplanation>
      <customDisplay/>
      <disabled>0</disabled>
      <editor>PureText</editor>
      <name>partialDiagnosisExplanation</name>
      <number>6</number>
      <picker>0</picker>
      <prettyName>Explanation for Partial Diagnosis</prettyName>
      <rows>5</rows>
      <size>40</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
    </partialDiagnosisExplanation>
    <prenatalDiagnosisDiscussed>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>select</displayFormType>
      <displayType/>
      <name>prenatalDiagnosisDiscussed</name>
      <number>23</number>
      <prettyName>Was prenatal diagnosis using these findings discussed?</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </prenatalDiagnosisDiscussed>
    <primaryVariantAnalysis>
      <cache>0</cache>
      <customDisplay>{{velocity}}
#set ($diagnostic = "diagnostic")##
#set ($potentiallyDiagnostic = "potentially-diagnostic")##
#set ($partiallyDiagnostic = "partially-diagnostic")##
#set ($nonDiagnostic = "non-diagnostic")##
#if ($xcontext.action == "edit")
{{html clean="false" wiki="false"}}
&lt;span class="xwiki-form-listclass"&gt;&lt;label for="${prefix}${name}-0"&gt;&lt;input id="${prefix}${name}-0" value="${diagnostic}" name="${prefix}${name}" type="radio" #if($value == $diagnostic)checked="checked"#end/&gt;$escapetool.xml($services.localization.render("PhenoTips.CarePathwaysPostTestSheet_primaryVariantAnalysis_${diagnostic}"))&lt;/label&gt; &lt;span class="fa fa-question-circle  xHelpButton" title="$escapetool.xml($services.localization.render("PhenoTips.CarePathwaysPostTestSheet_primaryVariantAnalysis_${diagnostic}_hint"))"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="xwiki-form-listclass"&gt;&lt;label for="${prefix}${name}-1"&gt;&lt;input id="${prefix}${name}-1" value="${potentiallyDiagnostic}" name="${prefix}${name}" type="radio" #if($value == $potentiallyDiagnostic)checked="checked"#end/&gt;$escapetool.xml($services.localization.render("PhenoTips.CarePathwaysPostTestSheet_primaryVariantAnalysis_${potentiallyDiagnostic}"))&lt;/label&gt; &lt;span class="fa fa-question-circle  xHelpButton" title="$escapetool.xml($services.localization.render("PhenoTips.CarePathwaysPostTestSheet_primaryVariantAnalysis_${potentiallyDiagnostic}_hint"))"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="xwiki-form-listclass"&gt;&lt;label for="${prefix}${name}-2"&gt;&lt;input id="${prefix}${name}-2" value="${partiallyDiagnostic}" name="${prefix}${name}" type="radio" #if($value == $partiallyDiagnostic)checked="checked"#end/&gt;$escapetool.xml($services.localization.render("PhenoTips.CarePathwaysPostTestSheet_primaryVariantAnalysis_${partiallyDiagnostic}"))&lt;/label&gt; &lt;span class="fa fa-question-circle  xHelpButton" title="$escapetool.xml($services.localization.render("PhenoTips.CarePathwaysPostTestSheet_primaryVariantAnalysis_${partiallyDiagnostic}_hint"))"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="xwiki-form-listclass"&gt;&lt;label for="${prefix}${name}-3"&gt;&lt;input id="${prefix}${name}-3" value="${nonDiagnostic}" name="${prefix}${name}" type="radio" #if($value == $nonDiagnostic)checked="checked"#end/&gt;$escapetool.xml($services.localization.render("PhenoTips.CarePathwaysPostTestSheet_primaryVariantAnalysis_${nonDiagnostic}"))&lt;/label&gt; &lt;span class="fa fa-question-circle  xHelpButton" title="$escapetool.xml($services.localization.render("PhenoTips.CarePathwaysPostTestSheet_primaryVariantAnalysis_${nonDiagnostic}_hint"))"&gt;&lt;/span&gt;&lt;/span&gt;
{{/html}}##
#else
{{html clean="false" wiki="false"}}
$escapetool.xml($services.localization.render("PhenoTips.CarePathwaysPostTestSheet_primaryVariantAnalysis_${value}")) &lt;span class="fa fa-question-circle xHelpButton" title="$escapetool.xml($services.localization.render("PhenoTips.CarePathwaysPostTestSheet_primaryVariantAnalysis_${value}_hint"))"&gt;&lt;/span&gt;
{{/html}}##
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <displayType>radio</displayType>
      <multiSelect>0</multiSelect>
      <name>primaryVariantAnalysis</name>
      <number>3</number>
      <picker>0</picker>
      <prettyName>Primary variant analysis</prettyName>
      <relationalStorage>0</relationalStorage>
      <separator>&lt;br/&gt;</separator>
      <separators> ,|</separators>
      <size>1</size>
      <sort>none</sort>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <values>diagnostic=Diagnostic|potentially-diagnostic=Potentially diagnostic|partially-diagnostic=Partially-diagnostic|non-diagnostic=Non-diagnostic</values>
      <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
    </primaryVariantAnalysis>
    <secondDegreeCounsellingPrimary>
      <customDisplay>{{velocity}}
#if ($type == 'edit')
{{html}}
&lt;select name="$prefix$name"&gt;
&lt;option value=""#if ("$!value" == '') selected="selected"#end&gt;&lt;/option&gt;
#foreach ($i in [0..99])
&lt;option value="$i"#if ($value == $i) selected="selected"#end&gt;$i&lt;/option&gt;
#end
&lt;/select&gt;
{{/html}}
#else
$!value
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <name>secondDegreeCounsellingPrimary</name>
      <number>12</number>
      <picker>0</picker>
      <prettyName>Number of 2nd degree relatives counselled</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </secondDegreeCounsellingPrimary>
    <secondDegreeCounsellingSecondary>
      <customDisplay>{{velocity}}
#if ($type == 'edit')
{{html}}
&lt;select name="$prefix$name"&gt;
&lt;option value=""#if ("$!value" == '') selected="selected"#end&gt;&lt;/option&gt;
#foreach ($i in [0..99])
&lt;option value="$i"#if ($value == $i) selected="selected"#end&gt;$i&lt;/option&gt;
#end
&lt;/select&gt;
{{/html}}
#else
$!value
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <name>secondDegreeCounsellingSecondary</name>
      <number>13</number>
      <picker>0</picker>
      <prettyName>Number of 2nd degree relatives counselled</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </secondDegreeCounsellingSecondary>
    <secondDegreeTestingPrimary>
      <customDisplay>{{velocity}}
#if ($type == 'edit')
{{html}}
&lt;select name="$prefix$name"&gt;
&lt;option value=""#if ("$!value" == '') selected="selected"#end&gt;&lt;/option&gt;
#foreach ($i in [0..99])
&lt;option value="$i"#if ($value == $i) selected="selected"#end&gt;$i&lt;/option&gt;
#end
&lt;/select&gt;
{{/html}}
#else
$!value
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <name>secondDegreeTestingPrimary</name>
      <number>14</number>
      <picker>0</picker>
      <prettyName>Number of 2nd degree relatives tested</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </secondDegreeTestingPrimary>
    <secondDegreeTestingSecondary>
      <customDisplay>{{velocity}}
#if ($type == 'edit')
{{html}}
&lt;select name="$prefix$name"&gt;
&lt;option value=""#if ("$!value" == '') selected="selected"#end&gt;&lt;/option&gt;
#foreach ($i in [0..99])
&lt;option value="$i"#if ($value == $i) selected="selected"#end&gt;$i&lt;/option&gt;
#end
&lt;/select&gt;
{{/html}}
#else
$!value
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <name>secondDegreeTestingSecondary</name>
      <number>15</number>
      <picker>0</picker>
      <prettyName>Number of 2nd degree relatives tested</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </secondDegreeTestingSecondary>
    <sequencingStrategy>
      <cache>0</cache>
      <customDisplay>{{velocity}}
#if ($type == 'edit')
{{html}}
#set ($defaultValueSelected = false)
&lt;ul&gt;
&lt;li class="term-entry"&gt;&lt;label&gt;&lt;input type="radio" name="$prefix$name" value="Proband only"#if ($value == 'Proband only') checked="checked"#set ($defaultValueSelected = true)#end /&gt; Proband only&lt;/label&gt;&lt;/li&gt;
&lt;li class="term-entry"&gt;&lt;label&gt;&lt;input type="radio" name="$prefix$name" value="Exome trio"#if ($value == 'Exome trio') checked="checked"#set ($defaultValueSelected = true)#end /&gt; Exome trio&lt;/label&gt;&lt;/li&gt;
&lt;li class="other-enabler term-entry"&gt;&lt;label&gt;&lt;input type="radio" name="$prefix$name"#if (!$defaultValueSelected)checked="checked" #end value="" /&gt; Other&lt;/label&gt;&lt;/li&gt;
&lt;li class="term-entry"&gt;&lt;input type="text" name="$prefix$name"#if (!$defaultValueSelected) value="$!value"#end placeholder="Sequencing strategy" /&gt;&lt;/li&gt;
&lt;/ul&gt;
{{/html}}
#else
#if ("$!value" != '')$value#{else}No data entered#end
#end
{{/velocity}}</customDisplay>
      <disabled>0</disabled>
      <displayType>select</displayType>
      <multiSelect>0</multiSelect>
      <name>sequencingStrategy</name>
      <number>24</number>
      <picker>0</picker>
      <prettyName>The WES sequencing strategy for my patient involved:</prettyName>
      <relationalStorage>0</relationalStorage>
      <separator> </separator>
      <separators>|, </separators>
      <size>1</size>
      <sort>none</sort>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <values/>
      <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
    </sequencingStrategy>
    <specificSurveillanceRecommended>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>select</displayFormType>
      <displayType/>
      <name>specificSurveillanceRecommended</name>
      <number>20</number>
      <prettyName>Was specific surveillance recommended?</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </specificSurveillanceRecommended>
    <specificSurveillanceStopped>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>select</displayFormType>
      <displayType/>
      <name>specificSurveillanceStopped</name>
      <number>21</number>
      <prettyName>Was specific surveillance stopped?</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </specificSurveillanceStopped>
    <specificTreatmentRecommended>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>select</displayFormType>
      <displayType/>
      <name>specificTreatmentRecommended</name>
      <number>18</number>
      <prettyName>Was specific treatment recommended?</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </specificTreatmentRecommended>
    <specificTreatmentStopped>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>select</displayFormType>
      <displayType/>
      <name>specificTreatmentStopped</name>
      <number>19</number>
      <prettyName>Was specific treatment stopped?</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </specificTreatmentStopped>
  </class>
  <object>
    <name>PhenoTips.CarePathwaysPostTestSheet</name>
    <number>0</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>dea91ae8-26b8-48c2-8ae6-2affd132af24</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code> // This validator variation should only be used in this section.
var $init = XWiki.widgets.DuplicateValidator.prototype.initialize;

XWiki.widgets.DuplicateValidator.addMethods({
  initialize : function (input, selector, message) {
    $init.bind(this)(input, selector, message);
    var reference = $$('table.gene-table.patient-sheet.extradata-list');
    this.refTable = reference.size() &gt; 0 &amp;&amp; reference[0];
  },

  check : function() {     
    if (this.input.value != this.value) {
      this.value = this.input.value;
      this.state = 'CHECKING';
      var curTable = this.input.up('table.gene-table.extradata-list');
      var tables;

      if (this.selector.include('gene-name')) {
        // Genes should not be replicated only in the current table.
        tables = [curTable];
      } else {
        // Variants should not be replicated in tables with the same subject (e.g. proband).
        var curTableId = curTable.id;
        var subjectAndType = curTableId.substring(0, curTableId.lastIndexOf('__')).split('-');
        var subject = subjectAndType[0];
        var type = subjectAndType[1];
        var _this = this;
        tables = $$('table.gene-table.extradata-list').filter(function(table) {
          return table != _this.refTable &amp;&amp; table.id.include(subject) ? true : false;
        })
      }
      this._checkData(tables);
    }
  },

  _checkData : function(tables) {
    var el = this.input;
    var allItems = [];
    var _this = this;
    tables.forEach(function(currentTable) {
      currentTable.select(_this.selector).each(function(item) {
        if (item != el) {
          allItems.push(item.value);
        }
      });
    });
    this._markStatus(allItems, el);
  },

  _markStatus : function(allItems, el) {
    if (allItems.indexOf(el.value) &gt; -1) {
      this.invalid();
    } else {
      this.available();
    }
    this.responded();
  }
});

var XWiki = (function(XWiki) {
  var validateOptionSelected = function (value) {
    return (value === '' || value === 'NA' || value === null || value === undefined) ? false : true;
  };

  var addFuzzyDateValidator = function(element) {
    if (!element.__validation) {
      element.__validation = new LiveValidation(element, {validMessage: '', wait : 500});
    }
    element.__validation.add(Validate.Presence, {failureMessage: "$escapetool.javascript($services.localization.render('phenotips.PatientSheetCode.failureSelectValue'))"});

    var fuzzyDiv = element.previous('div.fuzzy-date-picker');
    element.value = element.value === "{}" ? "" : element.value;
    if (fuzzyDiv) {
      fuzzyDiv.toggleClassName("invalid", !element.__validation.validate());
      element.observe("xwiki:date:changed", function(event) {
        fuzzyDiv.toggleClassName("invalid", !element.__validation.validate());
      });
    }
  };

  var init = function(event) {
    ((event &amp;&amp; event.memo.elements) || [$('body')]).each(function(varElement) {
      varElement.select(".variant.mandatory select").each(function(element) {
        if (!element.__validation) {
          element.__validation = new LiveValidation(element, {validMessage: '', wait : 500});
        }
        element.__validation.add(Validate.Custom, {against: validateOptionSelected, failureMessage: "$escapetool.javascript($services.localization.render('phenotips.PatientSheetCode.failureSelectValue'))"});
      });
      var moreInfoRow = varElement.next(".variant-moreinfo-row");
      (moreInfoRow ? [moreInfoRow] : varElement.select(".variant-moreinfo-row")).each(function(moreInfoRow) {
        moreInfoRow.select(".mandatory-date input.fuzzy-date").each(function(element) {
          addFuzzyDateValidator(element);
        });
        if (moreInfoRow.down(".LV_invalid_field")) {
          moreInfoRow.down("a.action-edit").click();
          moreInfoRow.previous().down('.show-moreinfo-button').click();
        }
      });
      // This is done so that scrollValidation will keep track of the fuzzy date picker elements.
      moreInfoRow &amp;&amp; Event.fire(document, "xwiki:dom:updated", {"elements" : [moreInfoRow]});
    });
    return true;
  };

  (XWiki.domIsLoaded &amp;&amp; init()) || document.observe("xwiki:dom:loaded", init);
  document.observe("xwiki:dom:updated", init);

  // End XWiki augmentation.
  return XWiki;
}(XWiki || {}));</code>
    </property>
    <property>
      <name>Care Pathways gene and variant duplicate validator widget</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathwaysPostTestSheet</name>
    <number>1</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>ab88ae43-7f26-427d-a078-dcfaca7a9e1e</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>var $editDoneData = ExtraGeneVariantData.tools.Editor.prototype.editDoneData;
var $areaEditData = ExtraGeneVariantData.tools.Editor.prototype.areaEditData;
ExtraGeneVariantData.tools.Editor.addMethods({
  editDoneData: function(event) {
    event.stop();
    var moreInfoRow = event.element().up("tr.variant-moreinfo-row");
    var valid = !moreInfoRow || !moreInfoRow.down(".LV_invalid_field");
    valid &amp;&amp; $editDoneData.bind(this)(event);
  },

  areaEditData: function(event) {
    var moreInfoRow = event.element().up("tr.variant-moreinfo-row");
    var valid = !moreInfoRow || !moreInfoRow.down(".LV_invalid_field");
    valid &amp;&amp; $areaEditData.bind(this)(event);
  },

  ajaxDeleteGeneData: function(event) {
    event.stop();
    var deleteTrigger = event.element();
    if (deleteTrigger.disabled) { return; };
    var className = deleteTrigger.up('td').className;
    var geneIndex = parseInt(className.substring(className.lastIndexOf('-') + 1), 10);
    var geneId = this._geneTable.select('[name="' + this.geneClassName + '_' + geneIndex + '_gene"]')[0].value;
   
    var _this = this;
    if (confirm("$!escapetool.javascript($services.localization.render('phenotips.tableMacros.cpRowDeleteConfirmation'))")) {
      var req = jQuery.ajax(deleteTrigger.href + geneId, {
        method: "GET",
        beforeSend: function () { deleteTrigger.disabled = true; }
      })
      .always(function () { deleteTrigger.disabled = false; })
      .done(function (data, textStatus, jqXHR) {
        var dataRow = deleteTrigger.up('tr:not(.head-group)');
        if (dataRow) {
          var geneIdInput = dataRow.down('input.gene-id');
          geneIdInput.remove();
          var geneNameInput = dataRow.down('input.gene-name');
          geneNameInput.__validation.destroy();

          _this._removeModulesForVariants.bind(_this, geneIndex)();

          _this._geneTable.select('.variant-gene-' + geneIndex).each(function (item) {
            item.select('td.mandatory :input:not([type="hidden"])', '.mandatory-date input.fuzzy-date').each(function(validatedElem) {
              validatedElem.__validation &amp;&amp; validatedElem.__validation.destroy();
            });
            item.remove();
          });
          dataRow.remove();
        }
        if (_this._geneTable) {
          var i = 1;
          _this._geneTable.select('td.row-count').each(function (item) {
            var geneRowIndex = item.next().className.substring(item.next().className.lastIndexOf('-') + 1);
            var y = 1;
            _this._geneTable.select('.variant-hide-heading-' + geneRowIndex + ' .variant-row-count').each(function (vitem) {
              vitem.childNodes[1].textContent = i + '.' + (y++);
            });
            item.update(i++);
          });
        }
      });
    }
  },

  _removeModulesForVariants : function(geneIndex) {
    var _this = this;
    var secondaryQuestionnaireContainer = $('posttest-questionnaire-secondary');
    if (this._geneTable.up('div#secondary-wes-variants-all') &amp;&amp; secondaryQuestionnaireContainer) {
      _this._geneTable.select('.variant-gene-' + geneIndex + ' td.variant.variant-default-input').each(function (item) {
        var variantIdx = item.className.substring(item.className.lastIndexOf('-') + 1);
        _this._removeModulesForVariant.bind(_this, secondaryQuestionnaireContainer, variantIdx)();
      });
    }
  },

  _removeModulesForVariant : function(container, variantIdx) {
    var modules = container.select('.care-pathways-modules-wrapper.with-variant-' + variantIdx);
    if (modules.size() &gt; 0) {
      modules.each(function(module) {
        var containingTable = module.up('table.care-pathways-module-group-container');
        module.remove();
        !containingTable.down('.care-pathways-modules-wrapper') &amp;&amp; containingTable.remove();
      });
    }
  },

  ajaxDeleteVariantData : function(event) {
    event.stop();
    var deleteTrigger = event.element();
    if (deleteTrigger.disabled) { return; };
    var geneClass = this.geneClassName;

    var _this = this;
    if (confirm("$!escapetool.javascript($services.localization.render('phenotips.tableMacros.cpRowDeleteConfirmation'))")) {
      var req = jQuery.ajax(deleteTrigger.href, {
        method: "GET",
        beforeSend: function () { deleteTrigger.disabled = true; }
      })
      .always(function () { deleteTrigger.disabled = false; })
      .done(function (data, textStatus, jqXHR) {
        var dataRow = deleteTrigger.up('tr:not(.head-group)');
        if (dataRow) {
          var cdnaCol = dataRow.down('.variant.cdna');
          var secondaryQuestionnaireContainer = $('posttest-questionnaire-secondary');
          if (_this._geneTable.up('div#secondary-wes-variants-all') &amp;&amp; secondaryQuestionnaireContainer) {
            var variantIdx = cdnaCol.className.substring(cdnaCol.className.lastIndexOf('-') + 1);
            _this._removeModulesForVariant.bind(_this, secondaryQuestionnaireContainer, variantIdx)();
          }
          var cdnaInput = cdnaCol.down('input');
          dataRow.select('td.mandatory :input:not([type="hidden"])').each(function(validatedElem) {
            validatedElem.__validation &amp;&amp; validatedElem.__validation.destroy();
          });
          var moreInfoRow = dataRow.next('tr.variant-moreinfo-row');
          moreInfoRow &amp;&amp; moreInfoRow.select('.mandatory-date input.fuzzy-date').each(function(validatedElem) {
            validatedElem.__validation &amp;&amp; validatedElem.__validation.destroy();
          });
          var className = dataRow.previous().className;
          var geneIndex = parseInt(className.substring(className.lastIndexOf('-') + 1), 10);
          //we are deleting the only variant in the gene: remove variant table header,
          //  unlock the genesymbol input field
          if (dataRow.previous().hasClassName('variant-title-row') &amp;&amp; dataRow.next(1).hasClassName('variant-footer')) {
            _this._geneTable.select('.variant-gene-' + geneIndex + '.variant-title-row').each(function(item) {
              item.remove();
            });
            _this._geneTable.select('[name="' + geneClass + '_' + geneIndex + '_symbol"]')[0].toggleClassName('v-collapsed', false);
            _this._geneTable.select('.gene.col-label.gene-' + geneIndex + '.gene-input-label')[0].toggleClassName('v-collapsed', true);
            dataRow.next().remove();
            dataRow.remove();
          } else {
            //we are removing variant from the middle of the table - updating table count
            dataRow.next().remove();
            dataRow.remove();
            var element = deleteTrigger.up('tr').select('.variant-row-count.variant')[0];
            // Get inner text in cross-browser manner
            var innerText = element.textContent || element.innerText;
            var geneCount = innerText.substring(0, innerText.indexOf('.'));
            var i = 1;
            _this._geneTable.select('.variant-hide-heading-' + geneIndex + ' .variant-row-count').each(function(item) {
              item.childNodes[1].textContent = geneCount + '.' + (i++);
            });
            //-update variant table header count
            var header = _this._geneTable.select('.variant.variant-title.gene-' + geneIndex)[0].firstChild;
            var newHeaderText = header.textContent.replace(/(\().+?(\))/g, "$1" + (--i) + "$2");
            header.textContent = newHeaderText;
          }
        }
      });
    }
  }
});</code>
    </property>
    <property>
      <name>Gene and variant delete behavior customizations</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathwaysPostTestSheet</name>
    <number>2</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>24574d06-ed47-4095-8ce3-d4cf9f4d6518</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>var getAssociatedGeneName = function(parentCol) {
  // Find the associated gene name.
  var geneColumn = parentCol.previous('td.v-collapsed');
  var geneContainer = geneColumn &amp;&amp; geneColumn.down('input[type="text"]');
  return geneContainer &amp;&amp; geneContainer.value || "";
};

var hideOnWarnFx = function(parentRow, moreInfoRow) {
  return function() {
    var hideOnWarn = parentRow.select('td.variant:not(.cdna, .variant-row-count) &gt; *');
    hideOnWarn.push(moreInfoRow);
    return hideOnWarn;
  };
};

var getImportButtonClickAction = function(cdnaInput, variantNumberStr, parentRow, moreInfoRow) {
  return function(data) {
    $H(data).each(function(pair) {
      var key = pair.key;
      var value = pair.value;

      var dataName = ':input[name="PhenoTips.CPGeneVariantClass_' + variantNumberStr + '_' + key + '"]';
      var formElems = moreInfoRow.select(dataName).concat(parentRow.select(dataName));

      if (formElems.length) {
        var currentCol;
        formElems.each(function(item) {
          if (item.type === "checkbox") {
            item.value === value &amp;&amp; (item.checked = true);
          } else {
            item.value = value;
          }
          var parentCol = item.up('td');
          if (parentCol !== currentCol) {
            currentCol = parentCol;
            var displayedElem = currentCol.down('span.variant-property-value.variant-label-' + variantNumberStr);
            displayedElem &amp;&amp; (displayedElem.innerHTML = value);
          }
        });
      }
      cdnaInput.__CPMatchingVariants_detector._markUnique();
      cdnaInput.__CPMatchingVariants_detector.responded();
    });
  };
};

var getDismissButtonClickAction = function(cdnaInput) {
  return function(data) {
    cdnaInput.__CPMatchingVariants_detector._markUnique();
    cdnaInput.__CPMatchingVariants_detector.responded();
  };
};

var getOnWarnButtons = function(cdnaInput, variantNumberStr, parentRow, moreInfoRow) {
  var importButton = new Element('button', {'class' : 'matching-variant-action import-variant-action secondary button', 'title' : 'Import matching variant data'}).insert('Import');
  var dismissButton = new Element('button', {'class' : 'matching-variant-action dismiss-variant-action secondary button', 'title' : 'Dismiss warning'}).insert('Dismiss');
  // The import button click action.
  importButton.clickAction = getImportButtonClickAction(cdnaInput, variantNumberStr, parentRow, moreInfoRow);
  // The dismiss button click action.
  dismissButton.clickAction = getDismissButtonClickAction(cdnaInput);

  return new Element('span', {'class' : 'matching-variant-actions-buttons'})
    .insert(new Element('span', {'class' : 'buttonwrapper'})
      .insert(importButton))
    .insert(new Element('span', {'class' : 'buttonwrapper'})
      .insert(dismissButton));
};

var attachDuplicateVariantsInPatientSheetValidator = function(event) {
  var serviceUrlEl = $('matching-patient-variants-url');
  var serviceUrl = serviceUrlEl &amp;&amp; serviceUrlEl.value

  if (serviceUrl) {
    var elements = event &amp;&amp; event.memo &amp;&amp; event.memo.elements;
    ((elements) || $$('.gene-table')).each(function(element) {
      var selector = 'td.variant.variant-default-input.cdna input';
      element.select(selector).each(function(cdnaInput) {
        var options = {};

        var parentRow = cdnaInput.up('tr');
        var geneNumberStr = parentRow.className.substring(parentRow.className.lastIndexOf("-") + 1);
        var moreInfoRow = parentRow.next('tr.variant-gene-' + geneNumberStr + '.variant-moreinfo-row');

        var parentCol = cdnaInput.up('td');
        var variantNumberStr = parentCol.className.substring(parentCol.className.lastIndexOf("-") + 1);

        // Add the servce url.
        options.serviceUrl = serviceUrl + '&amp;gene=' + getAssociatedGeneName(parentCol) + '&amp;cdna=';
        // Elements to hide when the warning is displayed.
        options.hideOnWarnFx = hideOnWarnFx(parentRow, moreInfoRow);
        // Buttons to add when the warning is displayed.
        options.addOnWarnButtons = getOnWarnButtons(cdnaInput, variantNumberStr, parentRow, moreInfoRow);
        // The container for the new buttons that will be added.
        options.addOnWarnButtonsContainer = parentCol.next('td');

        // Add the validator.
        var temp = function() {
          cdnaInput.__validation.validations = cdnaInput.__validation.validations.reject(function(i) {return i.type.name == 'bound validate'});
          cdnaInput.__CPMatchingVariants_detector = new PhenoTips.widgets.carePathways.RemoteDuplicatesValidator(cdnaInput, selector, "$escapetool.javascript($services.localization.render('PhenoTips.CPGeneVariantClass.valueAlreadyEnteredInPatientForm'))", options);
        }
        temp.delay();
      });
    });
  }
  return true;
};

(XWiki.domIsLoaded &amp;&amp; attachDuplicateVariantsInPatientSheetValidator()) || document.observe("xwiki:dom:loaded", attachDuplicateVariantsInPatientSheetValidator);
document.observe('xwiki:dom:updated', attachDuplicateVariantsInPatientSheetValidator);</code>
    </property>
    <property>
      <name>Care Pathways duplicate variant present in Patient Sheet validation</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathwaysPostTestSheet</name>
    <number>3</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>bc2eeb60-8445-4c63-8ce3-aafbc09a6716</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>(function() {
  var init = function() {
    // -----------------------------------------------------------------
    // Create and attach the suggests
    // -----------------------------------------------------------------
    if (typeof(PhenoTips.widgets.Suggest) != "undefined") {
       $$("input.suggest-genelist:not(.initialized)").each(function(item) {
          // Create the Suggest.
          item._suggest = new PhenoTips.widgets.Suggest(item, {
            script: XWiki.contextPath + "/rest/vocabularies/hgnc/suggest?",
            noresults: "$services.localization.render('phenotips.UIXField.genes.noMatches')",
            resultsParameter : "rows",
            resultId : "ensembl_gene_id",
            forceFirstId : true,
            resultValue : 'symbol',
            resultAltName : "alias_symbol",
            tooltip : 'gene-info',
            resultInfo : {},
            matchScript : XWiki.contextPath + "/rest/vocabularies/hgnc/"
          });
          if (typeof(PhenoTips.widgets.SuggestPicker) != "undefined") {
              var suggestPicker = new PhenoTips.widgets.SuggestPicker(item, item._suggest, {
                showDeleteTool : false,
                enableSort : false,
                showClearTool : false,
                inputType: 'checkbox',
                acceptFreeText : true
              });
              item._suggestPicker = suggestPicker;

              // Integrate the custom fields
              // 1. find the container element displaying them
              var customFieldsContainer = suggestPicker.list.up().down('.custom-display-data');
              if (customFieldsContainer) {
                 // 2. get rid of the container
                 customFieldsContainer.remove();
                 // 3. find all the values and display them as part of the multi suggest picker
                 var tmp = suggestPicker.silent;
                 suggestPicker.silent = true;
                 customFieldsContainer.select('.term-entry').each(function(entry) {
                   var notMapped = entry.hasClassName('notmapped');
                   var value =  entry.down('input[type="checkbox"]').value;
                   var text = entry.down('input[type="checkbox"]').title;
                   suggestPicker.addItem(value, text, '', '', notMapped);
                 });
                 suggestPicker.silent = tmp;
              }
          }
          item.addClassName('initialized');
       });
    }
  };
  (XWiki.domIsLoaded &amp;&amp; init()) || document.observe("xwiki:dom:loaded", init);
}());



</code>
    </property>
    <property>
      <name>Multiple select for genes</name>
    </property>
    <property>
      <parse/>
    </property>
    <property>
      <use>currentPage</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathwaysPostTestSheet</name>
    <number>4</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>bcd23add-32cd-4da0-b1d7-f710f7bf2c5a</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>(function() {
  var init = function(event) {
    var partialDiagnosisInput = $$('input[value="partially-diagnostic"]')[0];
    var diagnosisInputs = $$('input[name$="primaryVariantAnalysis"]');
    var partialDiagnosisExplanationField = $('partialDiagnosisExplanationField');
    if (!partialDiagnosisInput || !partialDiagnosisExplanationField) {
      return;
    }
    partialDiagnosisExplanationField.toggle(partialDiagnosisInput.checked);
    diagnosisInputs.invoke('observe', 'change', function() {
      partialDiagnosisExplanationField.toggle(partialDiagnosisInput.checked);
    });
  };
  (XWiki.domIsLoaded &amp;&amp; init()) || document.observe("xwiki:dom:loaded", init);
}());</code>
    </property>
    <property>
      <name>Only show "partial diagnosis explanation" when partial explanation is selected</name>
    </property>
    <property>
      <parse/>
    </property>
    <property>
      <use>currentPage</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathwaysPostTestSheet</name>
    <number>5</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>23d2080c-2454-4d0e-9fd1-1836b92aabda</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>(function() {
  var init = function(event) {
    $$('.other-enabler').each (function(element) {
      var otherRadio = element.down('input');
      var radios = $$('input[type="radio"][name="' + otherRadio.name + '"]');
      var otherInput = element.next();
      otherInput.toggle(otherRadio.checked);
      otherRadio.disabled = otherRadio.checked;
      radios.invoke('observe', 'change', function() {
        otherInput.toggle(otherRadio.checked);
        otherRadio.disabled = otherRadio.checked;
        otherRadio.checked &amp;&amp; otherInput.down('input').focus();
      });
    });
  };
  (XWiki.domIsLoaded &amp;&amp; init()) || document.observe("xwiki:dom:loaded", init);
}());</code>
    </property>
    <property>
      <name>Show text input when "other" is selected</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathwaysPostTestSheet</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>b3eb0460-b904-4a4b-a486-6e6499bd0e7b</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>6</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>3</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>1</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>5</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>4</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>#template('colorThemeInit.vm')

#care-pathways-posttest-container td {
  text-align: left;
}

#care-pathways-posttest-container div.no-variants-container,
#care-pathways-posttest-container .subject-variants-container {
  margin: 1em 0 1em 2em;
}

#care-pathways-posttest-container div.secondary-variants-container ul {
  margin: 0;
}

#care-pathways-posttest-container div.no-variant-container input[type="checkbox"] {
  margin-left: 0;
}

#care-pathways-posttest-container tr.care-pathways-modules.analysis .care-pathways-modules-wrapper {
  background-color: $theme.pageContentBackgroundColor;
  padding: 0;
}

#primary-variants-interpretation-container {
  margin-top: 1em;
  margin-bottom: 1em;
}

#primary-variants-interpretation-container .displayed-value {
  margin-left: 2em;
  display: block;
  padding-left: 0;
  border-left: none;
}

#primary-variants-interpretation-container .xwiki-form-listclass {
  display: block;
}

#care-pathways-posttest-container tr.variant-label-row td {
  background-color: $theme.backgroundSecondaryColor;
}

#care-pathways-posttest-container h2.group-label {
  font-size: 1.0em !important;
  font-weight: 700;
  letter-spacing: 0;
  text-align: left;
  text-transform: uppercase;
  color: $theme.panelHeaderTextColor;
  text-shadow: 0 1px 0 $theme.panelHeaderGradientColor;
  margin-top: 0;
  margin-bottom: 0;
  padding-left: .5em;
}

#care-pathways-posttest-container h3.subject-label {
  background-color: $theme.pageContentBackgroundColor;
  padding-left: 2.5em;
}
#care-pathways-posttest-container .chapter &gt; h2 {
  border: 0 none;
  color: black;
  font-family: sans;
  margin: -1.5em 0 0;
  padding: 0;
  text-transform: uppercase;
}
#care-pathways-posttest-container .chapter &gt; .expand-tools {
  margin-right: -5px;
}
#care-pathways-posttest-container .gene-table td.variant .buttonwrapper input.secondary,
#care-pathways-posttest-container .gene-table td.variant .buttonwrapper button.secondary,
#care-pathways-posttest-container .gene-table td.variant .buttonwrapper a.secondary,
#care-pathways-posttest-container .gene-table td.variant .buttonwrapper a.secondary:link,
#care-pathways-posttest-container .gene-table td.variant .buttonwrapper a.secondary:visited,
#care-pathways-posttest-container .gene-table td.variant .buttonwrapper a.secondary:active {
  margin-left: 9px;
}
#care-pathways-posttest-container .gene-table td.variant-default-input select {
  width: 180px;
}
#care-pathways-posttest-container .gene-table td.variant .buttonwrapper {
  width: 100%;
}
#care-pathways-posttest-container .gene-table td.variant .buttonwrapper a.button.delete-variant {
  position: relative;
  right: 0;
}
#care-pathways-posttest-container .gene-table td.variant,
#care-pathways-posttest-container .gene-table th.variant {
  background: $theme.backgroundSecondaryColor;
  min-width: 50px;
}
#care-pathways-posttest-container .gene-table .variant-title {
  background-color: $theme.panelCollapsedBackgroundColor !important;
}
#care-pathways-posttest-container .gene-table .variant-title:before {
  border-bottom: 15px solid $theme.panelCollapsedBackgroundColor;
}
#care-pathways-posttest-container .chapter div .expand-tools {
  margin-top: -2.0em;
  margin-right: -0.9em;
}
#care-pathways-posttest-container .variant label.create-button-label,
#care-pathways-posttest-container .variant .add-data-button:before {
  top: .40em !important;
  left: .6em;
}
#care-pathways-posttest-container .gene-table td.variant.moreinfo {
  min-width: 350px;
}
#care-pathways-posttest-container .gene-table .Status,
#care-pathways-posttest-container .gene-table .gene-t-header-status,
#care-pathways-posttest-container .gene-table .Subject,
#care-pathways-posttest-container .gene-table .gene-t-header-subject,
#care-pathways-posttest-container .gene-table .Strategy,
#care-pathways-posttest-container .gene-table .gene-t-header-strategy {
  display: none;
}

#care-pathways-posttest-container .gene-table .variant.interpretation option[value='benign'],
#care-pathways-posttest-container .gene-table .variant.interpretation option[value='likely_benign'] {
  display: none;
}

#care-pathways-posttest-container .transparent-row {
  border: 0 none;
}

.secondary-variants-container option[value="variant_u_s"] {
  display: none;
}</code>
    </property>
    <property>
      <contentType>CSS</contentType>
    </property>
    <property>
      <name>Care Pathways post test form styles</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>PhenoTips.CarePathwaysPostTestSheet</name>
    <number>0</number>
    <className>XWiki.UIExtensionClass</className>
    <guid>f8ea519c-f079-4ce4-b9c9-c3710bbd196d</guid>
    <class>
      <name>XWiki.UIExtensionClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <content>
        <disabled>0</disabled>
        <name>content</name>
        <number>3</number>
        <prettyName>Extension Content</prettyName>
        <rows>10</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </content>
      <extensionPointId>
        <disabled>0</disabled>
        <name>extensionPointId</name>
        <number>1</number>
        <prettyName>Extension Point ID</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </extensionPointId>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Extension ID</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parameters>
        <disabled>0</disabled>
        <name>parameters</name>
        <number>4</number>
        <prettyName>Extension Parameters</prettyName>
        <rows>10</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </parameters>
      <scope>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>scope</name>
        <number>5</number>
        <prettyName>Extension Scope</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>wiki=Current Wiki|user=Current User|global=Global</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </scope>
    </class>
    <property>
      <content/>
    </property>
    <property>
      <extensionPointId>org.phenotips.patientSheet.tab</extensionPointId>
    </property>
    <property>
      <name>org.phenotips.patientSheet.tab.care-pathways-posttest</name>
    </property>
    <property>
      <parameters>label=Care Pathways Post Test
cssId=care-pathways-posttest-tab
href=$doc.getURL("$!{xcontext.action}", "sheet=PhenoTips.CarePathwaysPostTestSheet&amp;returnTo=$!{xcontext.action}")
container=care-pathways-posttest-container
order=1</parameters>
    </property>
    <property>
      <scope>wiki</scope>
    </property>
  </object>
</xwikidoc>
